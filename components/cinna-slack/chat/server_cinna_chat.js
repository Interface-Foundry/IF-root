// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩтЪкЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЭдЁЯОАтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯМЪтЭдЁЯОАЁЯОАЁЯОАЁЯОАтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯОАЁЯОАЁЯОАЁЯСХЁЯОАЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯОАЁЯОАЁЯТЩЁЯТЩЁЯСХЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯСХЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪк
// тЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪк
// тЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТнЁЯТнЁЯТЩЁЯТнЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪк
// тЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪкЁЯМЪтЪктЪктЪктЪктЪкЁЯТнЁЯТнЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪкЁЯТнЁЯТнЁЯТнтЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪк
// тЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТнтЪктЪктЪктЪктЪктЪктЪкЁЯТнЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪк
// тЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯМЪтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТнЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪк
// тЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТнтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯМЪтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТнЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩ
// тЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩ
// тЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪлтЪлтЪлтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪлтЪлтЪлтЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩ
// тЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪкЁЯМЪтЪлтЪлтЪлтЪктЪктЪктЪктЪктЪктЪкЁЯМЪЁЯМЪтЪктЪктЪктЪктЪктЪлтЪлтЪлтЪлтЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩ
// тЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪкЁЯМХтЪлтЪлтЪлтЪктЪктЪктЪкЁЯНКЁЯНКЁЯНКЁЯНКЁЯНКЁЯНКЁЯНКтЪктЪктЪкЁЯМЪтЪлтЪлтЪлтЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩ
// тЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪкЁЯМХтЪктЪктЪктЪктЪкЁЯНКЁЯНКЁЯНКЁЯНКЁЯНКЁЯНКЁЯНКЁЯНКЁЯНКтЪктЪктЪкЁЯМХтЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩ
// тЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯРЩтЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТ░ЁЯНКЁЯНКЁЯНКЁЯНКЁЯНКЁЯНКЁЯНКтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩ
// тЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЫтЪкЁЯТЫтЪкЁЯНКтЪкЁЯТ░тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩ
// тЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩ
// тЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯРЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩтЪк
// тЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪк
// тЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩтЪктЪк
// тЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯРЩЁЯТЩЁЯТЩтЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪкЁЯТЩЁЯТЩЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪкЁЯТЩтЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪкЁЯМЪЁЯТЩтЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
// тЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪктЪк
//Cinna 0.6 (Cardamom)

var http = require('http');
var request = require('request');
var async = require('async');
var skype = require('./skype-sdk');
var builder = require('botbuilder');


// Initialize the BotService
var botService = new skype.BotService({
    messaging: {
        botId: "28:kip",
        serverUrl : "https://apis.skype.com",
        requestTimeout : 15000,
        appId: 'kip',
        appSecret: 'ac55e0b47d0e4e939aab4bbe44ea942a'
    }
});

// Create bot and add dialogs
var bot = new builder.SkypeBot(botService);
bot.add('/', function (session) {
   session.send('Hello World'); 
});

//set env vars
var config = require('config');

process.on('uncaughtException', function (err) {
  console.error('uncaught exception', new Date())
  console.error(err.stack);
});

//load kip modules
var ioKip = require("./components/io.js");

// website ЁЯМП
var express = require('express');
var app = express();
var server = require('http').createServer(app);
app.use(express.static(__dirname + '/static'))
app.get('/healthcheck', function (req, res) {
  res.send('ЁЯТм ЁЯМП')
})

server.listen(8000, function(e) {
  if (e) { console.error(e) }
  console.log('chat app listening on port 8000 ЁЯМП ЁЯТм')
})

//globals
var messageHistory = {}; //fake database, stores all users and their chat histories

//load incoming chat clients
ioKip.initSlackUsers(app.get('env'));
ioKip.loadSocketIO(server);

//incoming new slack user
app.get('/newslack', function(req, res) {
    ioKip.newSlack();
});

//incoming new slack user
app.get('/slackaction', function(req, res) {
    // ioKip.newSlack();
    console.log('incoming Slack action: ',req);
    ioKip.incomingSlackAction(req.body);
});	

//incoming new slack user
app.get('/kikincoming', function(req, res) {
    // ioKip.newSlack();
});

app.post('https://cc91ceca.ngrok.io/v1/chat', skype.messagingHandler(botService));

