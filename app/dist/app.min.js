function LandmarkNewCtrl(a,b,c,d,e){function f(a,c){"edit"==a&&(b.landmark.newStatus=!1,b.landmark.landmarkID=c,d.landmarks.create(b.landmark,function(a){})),void 0===a&&(b.landmark.newStatus=!0,b.landmark.parentID=b.worldID,d.landmarks.create(b.landmark,function(a){b.landmarkID=a[0]._id}))}b.landmarkID,b.worldID="029345823045982345",b.landmark={stats:{avatar:"img/tidepools/default.jpg"}},b.landmark.loc=[-74.0059,40.7127],b.landmark.name="Default",f(),shelfPan("return"),e.showSwitch=!1,e.showBack=!1,e.showBackPage=!1,""==c.type||"place"==c.type||"event"==c.type||"job"==c.type||a.path("/new");var g=new Date;b.subTypes=[],"event"==c.type&&(b.subTypes=b.subTypes.concat(eventCategories)),"place"==c.type&&(b.subTypes=b.subTypes.concat(placeCategories)),b.addEndDate=function(){b.landmark.date.end=b.landmark.date.start},angular.extend(b,{center:{lat:40.7615,lng:-73.9769,zoom:17},markers2:{m:{lat:40.7615,lng:-73.9769,message:"Drag to Location on map",focus:!0,draggable:!0,icon:local_icons.yellowIcon}},tiles:tilesDict.aicp}),angular.element("#fileupload").fileupload({url:"/api/upload_maps",paramName:coords_text,dataType:"text",progressall:function(a,b){$("#progress .bar").css("width","0%");var c=parseInt(b.loaded/b.total*100,10);$("#progress .bar").css("width",c+"%")},done:function(a,c){$("#uploadedpic").html(""),$("#preview").html(""),$("<p/>").text("Saved: "+c.originalFiles[0].name).appendTo("#uploadedpic"),$('<img src="'+c.result+'">').load(function(){$(this).width(150).height(150).appendTo("#preview")}),b.landmark.stats.avatar=c.result,b.mapIMG=c.result}}),b.buildMap=function(){var a={worldID:"53c4a0ab0ee5d8ccfa68a034",nw_loc_lng:-73.99749,nw_loc_lat:40.75683,sw_loc_lng:-73.99749,sw_loc_lat:40.7428,ne_loc_lng:-73.98472,ne_loc_lat:40.75683,se_loc_lng:-73.98472,se_loc_lat:40.7428},c=JSON.stringify(a),d={mapIMG:b.mapIMG,coords:c};$http.post("/api/build_map",d).success(function(a){})},b.locsearch=function(){var a=new google.maps.Geocoder;a&&a.geocode({address:b.landmark.location},function(a,c){c==google.maps.GeocoderStatus.OK&&b.$apply(function(){angular.extend(b,{center:{lat:a[0].geometry.location.lat(),lng:a[0].geometry.location.lng(),zoom:global_mapCenter.zoom},markers2:{m:{lat:a[0].geometry.location.lat(),lng:a[0].geometry.location.lng(),message:"Drag to Location",focus:!0,draggable:!0}}})})})},b.save=function(){function c(a){var b=a,c=b.indexOf("T");return b.substring(0,-1!=c?c:b.length)}b.landmark.date.end||(b.landmark.date.end=b.landmark.date.start),b.landmark.datetext={start:b.landmark.date.start,end:b.landmark.date.end},b.landmark.date.start=new Date(b.landmark.date.start).toISOString(),b.landmark.date.end=new Date(b.landmark.date.end).toISOString(),b.landmark.date.start=c(b.landmark.date.start),b.landmark.date.end=c(b.landmark.date.end),b.landmark.date.start=b.landmark.date.start.replace(/(\d+)-(\d+)-(\d+)/,"$2-$3-$1"),b.landmark.date.end=b.landmark.date.end.replace(/(\d+)-(\d+)-(\d+)/,"$2-$3-$1"),b.landmark.time.start||(b.landmark.time.start="00:00"),b.landmark.time.end||(b.landmark.time.end="23:59"),b.landmark.timetext={start:b.landmark.time.start,end:b.landmark.time.end},b.landmark.loc=[b.markers2.m.lat,b.markers2.m.lng],d.landmarks.create(b.landmark,function(b){a.path("/post/"+b[0].id+"/new")})},b.landmark={stats:{avatar:"img/tidepools/default.jpg"},type:c.type,date:{start:g}},b.landmark.loc=[]}function LandmarkEditCtrl(a,b,c,d,e,f,g){g.showSwitch=!1,shelfPan("return"),a.get({_id:d.landmarkId},function(a){c.landmark=a,a.loc_nicknames&&(c.landmark.location=a.loc_nicknames),c.landmark.idCheck=a.id,c.subTypes=[],"event"==a.type&&(c.subTypes=c.subTypes.concat(eventCategories)),"place"==a.type&&(c.subTypes=c.subTypes.concat(placeCategories)),"event"==a.type&&(c.landmark.date={start:a.timetext.datestart,end:a.timetext.dateend},c.landmark.time={start:a.timetext.timestart,end:a.timetext.timeend}),angular.extend(g,{markers:{}}),angular.extend(g,{center:{lat:c.landmark.loc[0],lng:c.landmark.loc[1],zoom:17},markers:{m:{lat:c.landmark.loc[0],lng:c.landmark.loc[1],message:"Drag to Location on map",focus:!0,draggable:!0,icon:local_icons.yellowIcon}},tiles:tilesDict.aicp}),$('<img src="'+c.landmark.stats.avatar+'">').load(function(){$(this).width(150).height(150).appendTo("#preview")})});new Date;c.addEndDate=function(){c.landmark.date.end=c.landmark.date.start},angular.element("#fileupload").fileupload({url:"/api/upload",dataType:"text",progressall:function(a,b){$("#progress .bar").css("width","0%");var c=parseInt(b.loaded/b.total*100,10);$("#progress .bar").css("width",c+"%")},done:function(a,b){$("#uploadedpic").html(""),$("#preview").html(""),$("<p/>").text("Saved: "+b.originalFiles[0].name).appendTo("#uploadedpic"),$('<img src="'+b.result+'">').load(function(){$(this).width(150).height(150).appendTo("#preview")}),c.landmark.stats.avatar=b.result}}),c.save=function(){function a(a){var b=a,c=b.indexOf("T");return b.substring(0,-1!=c?c:b.length)}"event"==c.landmark.type&&(c.landmark.date.end||(c.landmark.date.end=c.landmark.date.start),c.landmark.datetext={start:c.landmark.date.start,end:c.landmark.date.end},c.landmark.date.start=new Date(c.landmark.date.start).toISOString(),c.landmark.date.end=new Date(c.landmark.date.end).toISOString(),c.landmark.date.start=a(c.landmark.date.start),c.landmark.date.end=a(c.landmark.date.end),c.landmark.date.start=c.landmark.date.start.replace(/(\d+)-(\d+)-(\d+)/,"$2-$3-$1"),c.landmark.date.end=c.landmark.date.end.replace(/(\d+)-(\d+)-(\d+)/,"$2-$3-$1"),c.landmark.time.start||(c.landmark.time.start="00:00"),c.landmark.time.end||(c.landmark.time.end="23:59"),c.landmark.timetext={start:c.landmark.time.start,end:c.landmark.time.end}),c.landmark.loc=[g.markers.m.lat,g.markers.m.lng],e.landmarks.create(c.landmark,function(a){b.path("/post/"+a[0].id+"/new")})},c.delete=function(){var b=confirm("Are you sure you want to delete this item?");b&&a.del({_id:c.landmark._id},function(){})}}function WorldEditCtrl(){}function UserViewCtrl(){}function WorldMakerCtrl(a,b,c,d,e,f){function g(){f.getMap("worldDetailMap").then(function(a){a.invalidateSize()})}function h(a){userLat=a.coords.latitude,userLon=a.coords.longitude,b.center={lat:userLat,lng:userLon,zoom:12},b.tiles=tilesDict.mapbox,b.markers={m:{lat:userLat,lng:userLon,message:"<p style='color:black;'>Drag to Location on map</p>",focus:!0,draggable:!0,icon:local_icons.yellowIcon}},g()}function i(){}function j(a){b.hasTime=!1,b.world.loc=[b.markers.m.lat,b.markers.m.lng],b.world.userID=b.userID,"edit"==a?(b.world.newStatus=!1,b.world.worldID=b.worldID,d.worlds.create(b.world,function(a){})):"map"==a?(b.mapping.editMap=!0,b.mapping.worldID=b.worldID,d.worlds.create(b.mapping,function(a){})):(b.world.newStatus=!0,d.worlds.create(b.world,function(a){b.worldID=a[0].worldID,b.projectID=a[0].projectID,b.styleID=a[0].styleID,b.worldURL=a[0].worldURL}))}function k(){b.styles.styleID=b.styleID,d.styles.create(b.styles,function(a){})}f.getMap("worldDetailMap");b.userID="53ab92d2ac23550e12600011",b.username="interfoundry",b.worldID,b.worldURL,b.styleID,b.projectID,b.pageIndex=0,b.pageClass=[],b.pageClass[0]="current",b.pageClass[1]="right",b.pageClass[2]="right",b.pageClass[3]="right",b.pageClass[4]="right",b.mapConfirm="false",b.world={stats:{avatar:"img/tidepools/default.jpg"}},b.mapping={},b.styles={},b.project={},b.mapThemes=[{name:"urban"},{name:"fairy"},{name:"sunset"},{name:"arabesque"}],b.mapping.mapThemeSelect=b.mapThemes[0],b.markerOptions=[{name:"red"},{name:"orange"},{name:"yellow"},{name:"green"},{name:"blue"},{name:"purple"}],b.mapping.markerSelect=b.markerOptions[0],b.bgColor="#CCC",angular.extend(b,{worldDetailPaths:{}}),$(".color").spectrum({clickoutFiresChange:!0}),angular.element("#fileupload").fileupload({url:"/api/upload",dataType:"text",progressall:function(a,b){$("#progress .bar").css("width","0%");var c=parseInt(b.loaded/b.total*100,10);$("#progress .bar").css("width",c+"%")},done:function(a,c){$("#uploadedpic").html(""),$("#preview").html(""),$("<p/>").text("Saved: "+c.originalFiles[0].name).appendTo("#uploadedpic"),$('<img src="'+c.result+'">').load(function(){$(this).width(150).height(150).appendTo("#preview")}),b.world.stats.avatar=c.result}}),b.nextPage=function(){b.pageIndex<b.pageClass.length-1&&(b.pageClass[b.pageIndex]="left",0==b.pageIndex&&(b.worldID?j("edit"):j()),1==b.pageIndex&&j("map"),3==b.pageIndex&&k(),b.pageIndex+=1,b.pageClass[b.pageIndex]="current")},b.prevPage=function(){b.pageIndex>0&&(b.pageClass[b.pageIndex]="right",b.pageIndex=b.pageIndex-1,b.pageClass[b.pageIndex]="current")},b.maplocsearch=function(a){if(13==a.keyCode){var c=new google.maps.Geocoder;c&&c.geocode({address:b.locsearchbar},function(a,c){c==google.maps.GeocoderStatus.OK&&(b.center.lat=a[0].geometry.location.lat(),b.center.lng=a[0].geometry.location.lng(),b.markers.m.lat=a[0].geometry.location.lat(),b.markers.m.lng=a[0].geometry.location.lng())})}},b.mapLock=function(){b.mapConfirm?(b.markers.m.draggable=!1,b.worldDetailPaths={},b.worldDetailPaths.circle={type:"circle",radius:5e3,latlngs:{lat:b.markers.m.lat,lng:b.markers.m.lng}}):b.markers.m.draggable=!0},navigator.geolocation&&(navigator.geolocation.getCurrentPosition(h,i,{timeout:5e4}),g()),b.myData={link:"http://google.com",modalShown:!1,hello:"world",foo:"bar"},b.logClose=function(){},b.toggleModal=function(){b.myData.modalShown=!b.myData.modalShown}}function UserCtrl(a,b,c,d){b.userID="53ab92d2ac23550e12600011",b.username="interfoundry",b.worlds=d.worlds.query({queryType:"all",userID:"539533e5d22c979322000001"},function(a){})}function shelfPan(a,b){"return"==a&&($("body").hasClass("lense2")&&($("body").toggleClass("lense2"),$("#shelf").css({"-webkit-transform":"translateY(0px)","-moz-transform":"translateY(0px)","-ms-transform":"translateY(0px)","-o-transform":"translateY(0px)",transform:"translateY(0px)"}),$("#leafletmap").css({height:"183px"})),$("body").hasClass("lense")&&($("body").toggleClass("lense"),$("#shelf").css({"-webkit-transform":"translateY(0px)","-moz-transform":"translateY(0px)","-ms-transform":"translateY(0px)","-o-transform":"translateY(0px)",transform:"translateY(0px)"}),$("#leafletmap").css({height:"183px"}))),"full"==a&&($("body").hasClass("lense")?"navbar"==b?(he=$(window).height(),he-="navbar"==b?72:172,$("body").toggleClass("lense2"),$("body").toggleClass("lense"),$("#shelf").css({"-webkit-transform":"translateY("+he+"px)","-moz-transform":"translateY("+he+"px)","-ms-transform":"translateY("+he+"px)","-o-transform":"translateY("+he+"px)",transform:"translateY("+he+"px)"}),$("#leafletmap").css({height:he+"px"})):($("body").toggleClass("lense"),$("#shelf").css({"-webkit-transform":"translateY(0px)","-moz-transform":"translateY(0px)","-ms-transform":"translateY(0px)","-o-transform":"translateY(0px)",transform:"translateY(0px)"}),$("#leafletmap").css({height:"183px"})):$("body").hasClass("lense2")?(he=$(window).height(),he-="navbar"==b?72:172,$("body").toggleClass("lense2"),$("body").toggleClass("lense"),$("#shelf").css({"-webkit-transform":"translateY("+he+"px)","-moz-transform":"translateY("+he+"px)","-ms-transform":"translateY("+he+"px)","-o-transform":"translateY("+he+"px)",transform:"translateY("+he+"px)"}),$("#leafletmap").css({height:he+"px"})):(he=$(window).height(),he-="navbar"==b?72:172,$("body").toggleClass("lense"),$("#shelf").css({"-webkit-transform":"translateY("+he+"px)","-moz-transform":"translateY("+he+"px)","-ms-transform":"translateY("+he+"px)","-o-transform":"translateY("+he+"px)",transform:"translateY("+he+"px)"}),$("#leafletmap").css({height:he+"px"}))),"partial"==a&&($("body").hasClass("lense")?($("body").toggleClass("lense"),$("#shelf").css({"-webkit-transform":"translateY(0px)","-moz-transform":"translateY(0px)","-ms-transform":"translateY(0px)","-o-transform":"translateY(0px)",transform:"translateY(0px)"}),$("#leafletmap").css({height:"149px"})):$("body").hasClass("lense2")?($("body").toggleClass("lense2"),$("#shelf").css({"-webkit-transform":"translateY(0px)","-moz-transform":"translateY(0px)","-ms-transform":"translateY(0px)","-o-transform":"translateY(0px)",transform:"translateY(0px)"}),$("#leafletmap").css({height:"149px"})):($("body").toggleClass("lense2"),$("#shelf").css({"-webkit-transform":"translateY(149px)","-moz-transform":"translateY(149px)","-ms-transform":"translateY(149px)","-o-transform":"translateY(149px)",transform:"translateY(149px)"}),$("#leafletmap").css({height:"149px"}))),"new"==a&&($("body").toggleClass("lense"),$("#shelf").css({"-webkit-transform":"translateY(250px)","-moz-transform":"translateY(250px)","-ms-transform":"translateY(250px)","-o-transform":"translateY(250px)",transform:"translateY(250px)"}),$("#leafletmap").css({height:"250px"}))}function WorldRouteCtrl(a,b,c,d,e,f,g){function h(){b.showNoLoc=!0,angular.extend(e,{loading:!1}),b.$apply()}function i(c,f){b.worlds=d.worlds.query({localTime:new Date,userCoordinate:[f,c]},function(b){e.altBubbles=b[0].liveAndInside,e.nearbyBubbles=b[0].live,null!=b[0].liveAndInside[0]&&b[0].liveAndInside[0].id?a.path("w/"+b[0].liveAndInside[0].id):j()})}function j(){b.showCreateNew=!0,angular.extend(e,{loading:!1})}angular.extend(e,{loading:!0});var k=g;k.resetNavBG(),b.aperture=f,b.aperture.set("off"),b.initGeo=function(){function a(a){var b=a.coords.latitude,c=a.coords.longitude;i(b,c)}function b(){h()}navigator.geolocation?navigator.geolocation.getCurrentPosition(a,b,{timeout:15e3,enableHighAccuracy:!0}):alert("Your browser does not support geolocation :(")},b.initGeo(),b.addWorld=function(){a.path("/profile")}}function indexIF(a,b,c,d,e,f,g,h,i,j,k,a,l,m,n,o){b.aperture=f,b.map=g,b.style=h,b.alerts=i,e.messages=[],angular.extend(e,{globalTitle:"Bubbl.li"}),angular.extend(e,{navTitle:"Bubbl.li"}),angular.extend(e,{loading:!1}),b.$on("$viewContentLoaded",function(){document.getElementById("wrap").scrollTop=0}),b.search=function(){1==b.searchOn?(a.path("/search/"+b.searchText),b.searchOn=!1):b.searchOn=!0};var p=function(a,b,c,d,e){var f=a.defer();return c.get("/api/user/loggedin").success(function(a){"0"!==a?(e.userName=a.facebook?a.facebook.name:a.twitter?a.twitter.displayName:a.local?a.local.email:"Me",e.showLogout=!0,b(f.resolve,0)):(e.showLogout=!1,e.message="You need to log in.",b(function(){f.reject()},0))}),f.promise};b.sendFeedback=function(){var a={emailText:"FEEDBACK:\n"+o(b.feedbackText)+"\n===\n===\n"+e.userName};m.post("feedback",a).success(function(){alert("Feedback sent, thanks!")}).error(function(){}),b.feedbackOn=!1},p(n,l,m,a,e),b.sessionSearch=function(){b.landmarks=c.landmarks.query({queryType:"search",queryFilter:b.searchText})}}function TweetlistCtrl(a,b,c,d,e,f){d.showSwitch=!1;var g=f;g.set("off"),b.currentTag=e.hashTag,b.tweets=c.tweets.query({limit:70,tag:b.currentTag}),b.tagSearch=function(){var a=b.searchText.replace("#","");b.tweets=c.tweets.query({tag:a})},b.goBack=function(){window.history.back()}}function InstalistCtrl(a,b,c,d,e,f){var g=f;g.set("off"),d.showSwitch=!1,b.currentTag=e.hashTag,b.instagrams=c.instagrams.query({limit:20,tag:b.currentTag}),b.goBack=function(){window.history.back()}}function TalktagCtrl(a,b,c,d,e){e.showSwitch=!1,b.currentTag=c.hashTag,b.globalhashtag=global_hashtag,b.time="all",b.tweets=d.tweets.query({tag:c.hashTag,time:b.time}),b.goBack=function(){window.history.back()},b.goTalk=function(){a.path("talk")}}function MenuCtrl(a,b,c,d,e){shelfPan("return"),window.scrollTo(0,0),e.showSwitch=!1,b.goBack=function(){window.history.back()},b.shelfUpdate=function(a){b.shelfUpdate=b.shelfUpdate==a?"default":a},b.menuType=d.type}function ListCtrl(a,b,c,d,e){function f(){b.listLimit=10,b.queryType="events",b.queryFilter=d.filter,b.queryCat=d.category,b.landmarksList=c.landmarks.query({queryType:b.queryType,queryFilter:b.queryFilter,queryCat:b.queryCat,nowTimeEnd:"noNow"},function(){})}shelfPan("return"),window.scrollTo(0,0),e.showBack=!1,e.showBackPage=!1,e.showBackMark=!1,e.showSwitch=!1,b.goBack=function(){window.history.back()},b.shelfUpdate=function(a){b.shelfUpdate=b.shelfUpdate==a?"default":a},b.listType=d.category,"lecture"==b.listType&&(b.day="WEDNESDAY"),"award"==b.listType&&(b.day="TUESDAY"),"show"==b.listType&&(b.day="THURSDAY"),f(),b.filter=function(a,d){b.landmarks=c.landmarks.query({queryType:a,queryFilter:d})}}function ChatCtrl(a,b,c,d,e){a.aperture=e,a.aperture.set("off"),b.on("init",function(a){d.chatName=a.name,d.users=a.users}),b.on("send:message",function(a){d.messages.push(a)}),b.on("change:name",function(a){f(a.oldName,a.newName)});var f=function(a,b){var c;for(c=0;c<d.users.length;c++)d.users[c]===a&&(d.users[c]=b)};a.changeName=function(){b.emit("change:name",{name:a.newName},function(b){b?(f(d.chatName,a.newName),d.chatName=a.newName,a.newName=""):alert("That name is already in use")})},a.sendMessage=function(){b.emit("send:message",{message:a.message});var c=new Date,e=(c.getSeconds()<10?"0":"")+c.getSeconds(),f=(c.getMinutes()<10?"0":"")+c.getMinutes(),g=c.getHours();d.messages.push({user:d.chatName,text:a.message,time:g+":"+f+":"+e}),a.message=""},a.sendEmo=function(b){var c,d="/img/emoji/";switch(b){case"cool":c=d+"cool.png";break;case"dolphin":c=d+"dolphin.png";break;case"ghost":c=d+"ghost.png";break;case"heart":c=d+"heart.png";break;case"love":c=d+"love.png";break;case"party":c=d+"party.png";break;case"smile":c=d+"smile.png";break;case"woah":c=d+"woah.png";break;default:c=d+"love.png"}a.message='<img src="'+c+'">',a.sendMessage()}}function WorldViewCtrl(a,b,c,d,e,f,g,h,i){"m"==b.option||shelfPan("closed"),"new"==b.option,angular.extend(i,{markers:{}}),c.option=b.option,c.landmark=a.get({_id:b.worldID},function(a){c.mainImageUrl=a.stats.avatar,c.time="all",c.currentTag=c.landmark.tags,c.tweets=d.tweets.query({tag:c.landmark.tags,time:c.time});var e={m:{lat:c.landmark.loc[0],lng:c.landmark.loc[1],message:'<h4><img style="width:70px;" src="'+a.stats.avatar+'"><a href=#/landmark/'+b.landmarkId+"/m> "+a.name+"</a></h4>",focus:!0,icon:local_icons.yellowIcon}};angular.extend(i,{center:{lat:c.landmark.loc[0],lng:c.landmark.loc[1],zoom:16},markers:e})}),c.open=function(){c.etherpad=!0},c.close=function(){c.etherpad=!1},c.opts={backdropFade:!0,dialogFade:!0},c.setImage=function(a){c.mainImageUrl=a},c.goBack=function(){window.history.back(),shelfPan("return")},c.edit=function(){e.path("/landmark/"+b.landmarkId+"/edit")}}function LandmarkViewCtrl(a,b,c,d,e,f,g,h,i){function j(a){"event"==a.type&&(l[a.loc_nickname]?(angular.extend(i,{center:{lat:l[a.loc_nickname][0],lng:l[a.loc_nickname][1],zoom:m,autoDiscover:!1},markers:{m:{lat:l[a.loc_nickname][0],lng:l[a.loc_nickname][1],message:"<h4>"+a.loc_nickname+"</h4>",focus:!0,icon:local_icons.yellowIcon}},tiles:tilesDict.mapbox}),k()):(angular.extend(i,{center:{lat:l.NYC[0],lng:l.NYC[1],zoom:m},markers:{m:{lat:l.NYC[0],lng:l.NYC[1],message:"<h4>NYC</h4>",focus:!0,icon:local_icons.yellowIcon}},tiles:tilesDict.mapbox}),k())),"place"==a.type&&("m"==b.option?(angular.extend(i,{center:{lat:a.loc[0],lng:a.loc[1],zoom:19,autoDiscover:!1},tiles:tilesDict.aicp}),k()):(angular.extend(i,{center:{lat:a.loc[0],lng:a.loc[1],zoom:19,autoDiscover:!1},markers:{m:{lat:a.loc[0],lng:a.loc[1],message:'<h4><img style="width:70px;" src="'+a.stats.avatar+'"><a href=#/post/'+a.id+"/m> "+a.name+"</a></h4>",focus:!1,icon:local_icons.yellowIcon}},tiles:tilesDict.aicp}),k()))}function k(){g.getMap().then(function(a){a.invalidateSize()})}i.showSwitch=!1,i.showBackPage=!0,i.showNavIcons=!1,window.scrollTo(0,0);var l={BASECAMP:[40.7215408,-73.9967013],SKIRBALL:[40.7297,-73.9978],MoMA:[40.7615,-73.9777],NYC:[40.7127,-74.0059]},m=16;c.showMapNav=function(){1==i.showMapNav?(i.showMapNav=!1,shelfPan("partial")):i.showMapNav=!0},"m"==b.option?(shelfPan("partial"),i.showSwitch=!1,i.showBackPage=!1,i.showBack=!1,i.showMapNav=!1,i.showBackMark=!0,i.hideIFbar=!1):(shelfPan("partial"),angular.extend(i,{markers:{}})),c.option=b.option,c.landmark=a.get({_id:b.landmarkId},function(a){a.stats.avatar&&"img/tidepools/default.jpg"!==a.stats.avatar&&(c.mainImageUrl=a.stats.avatar),c.people=a.people,c.description=a.description,j(a),c.landmark.tags&&(c.time="all",c.currentTag=c.landmark.tags,c.tweets=d.tweets.query({tag:c.landmark.tags,time:c.time}))}),c.setImage=function(a){c.mainImageUrl=a},c.goBack=function(){window.history.back(),shelfPan("return")},c.edit=function(){e.path("/landmark/"+b.landmarkId+"/edit")}}function AwardsCtrl(a,b,c,d,e,f){function g(){e.getMap().then(function(a){a.invalidateSize()})}function h(a){"noNow"==a?k==n?(b.upcomingLimit=2,b.queryType="events",b.queryFilter="upcoming",b.queryCat=p,b.landmarksUpcoming=c.landmarks.query({queryType:b.queryType,queryFilter:b.queryFilter,queryCat:b.queryCat,nowTimeEnd:"upcomingToday"},function(a){0==a.length&&i()})):i():(b.upcomingLimit=1,b.queryType="events",b.queryFilter="upcoming",b.queryCat=p,b.landmarksUpcoming=c.landmarks.query({queryType:b.queryType,queryFilter:b.queryFilter,queryCat:b.queryCat,nowTimeEnd:a},function(){}))}function i(){b.happenedLimit=10,b.queryType="events",b.queryFilter="all",b.queryCat=p,b.landmarksHappened=c.landmarks.query({queryType:b.queryType,queryFilter:b.queryFilter,queryCat:b.queryCat},function(){})}shelfPan("return"),window.scrollTo(0,0);var j=new Date,k=j.getDate(),l=j.getMonth()+1,m=j.getFullYear();10>k&&(k="0"+k),10>l&&(l="0"+l);var j=k+"/"+l+"/"+m,n=10;n==k&&(b.itisToday=!0),f.showBack=!1,f.showBackPage=!1,f.showBackMark=!1,f.hideIFbar=!1,f.showNavIcons=!1,f.showMapNav=!1;var o={BASECAMP:[40.7215408,-73.9967013],SKIRBALL:[40.7297,-73.9978]};angular.extend(f,{markers:{}}),angular.extend(f,{center:{lat:40.725,lng:-73.997,zoom:14},tiles:tilesDict.mapbox,markers:{b:{lat:o.SKIRBALL[0],lng:o.SKIRBALL[1],message:"<h4>SKIRBALL</h4>",focus:!1,icon:local_icons.yellowIcon},a:{lat:o.BASECAMP[0],lng:o.BASECAMP[1],message:"<h4>BASECAMP</h4>",focus:!0,icon:local_icons.yellowIcon}}}),g(),f.showSwitch=!0,f.radioModel="Tuesday",b.tweets=c.tweets.query({limit:1}),b.instagrams=c.instagrams.query({limit:1}),b.hideSwitch=function(){1==f.showSwitch?(f.showSwitch=!1,f.showBack=!0):(f.showSwitch=!0,f.showBack=!1)},f.goBack=function(){window.history.back()},b.shelfUpdate=function(a){b.shelfUpdate=b.shelfUpdate==a?"default":a},b.refreshMap=function(){e.getMap().then(function(a){a.invalidateSize()})};var p="award";b.queryType="events",b.queryFilter="now",b.queryCat=p,b.landmarksNow=c.landmarks.query({queryType:b.queryType,queryFilter:b.queryFilter,queryCat:b.queryCat},function(){h(b.landmarksNow[0]?b.landmarksNow[0].time.end:"noNow")}),b.filter=function(a,d){b.landmarks=c.landmarks.query({queryType:a,queryFilter:d})},b.goTalk=function(b){a.path("talk/"+b)},b.goTalkList=function(){a.path("talk")},b.goVote=function(){a.path("poll")}}function LecturesCtrl(a,b,c,d,e,f){function g(a){"noNow"==a?j==m?(b.upcomingLimit=2,b.queryType="events",b.queryFilter="upcoming",b.queryCat=o,b.landmarksUpcoming=c.landmarks.query({queryType:b.queryType,queryFilter:b.queryFilter,queryCat:b.queryCat,nowTimeEnd:a},function(a){0==a.length&&h()})):h():(b.upcomingLimit=1,b.queryType="events",b.queryFilter="upcoming",b.queryCat=o,b.landmarksUpcoming=c.landmarks.query({queryType:b.queryType,queryFilter:b.queryFilter,queryCat:b.queryCat,nowTimeEnd:a},function(){}))}function h(){b.happenedLimit=10,b.queryType="events",b.queryFilter="all",b.queryCat=o,b.landmarksHappened=c.landmarks.query({queryType:b.queryType,queryFilter:b.queryFilter,queryCat:b.queryCat},function(){})}shelfPan("return"),window.scrollTo(0,0);var i=new Date,j=i.getDate(),k=i.getMonth()+1,l=i.getFullYear();10>j&&(j="0"+j),10>k&&(k="0"+k);var i=j+"/"+k+"/"+l,m=11;m==j&&(b.itisToday=!0),f.showBack=!1,f.showBackPage=!1,f.showBackMark=!1,f.hideIFbar=!1,f.showNavIcons=!1,f.showMapNav=!1,angular.extend(f,{markers:{}});var n={BASECAMP:[40.7215408,-73.9967013],MoMA:[40.7615,-73.9777]};angular.extend(f,{center:{lat:40.7415,lng:-73.985,zoom:12},tiles:tilesDict.mapbox,markers:{b:{lat:n.MoMA[0],lng:n.MoMA[1],message:"<h4>MoMA</h4>",focus:!1,icon:local_icons.yellowIcon},a:{lat:n.BASECAMP[0],lng:n.BASECAMP[1],message:"<h4>BASECAMP</h4>",focus:!0,icon:local_icons.yellowIcon}}}),f.radioModel="Wednesday",f.showSwitch=!0,b.tweets=c.tweets.query({limit:1}),b.instagrams=c.instagrams.query({limit:1}),b.hideSwitch=function(){1==f.showSwitch?(f.showSwitch=!1,f.showBack=!0):(f.showSwitch=!0,f.showBack=!1)},f.goBack=function(){window.history.back()},b.shelfUpdate=function(a){b.shelfUpdate=b.shelfUpdate==a?"default":a};var o="lecture";b.queryType="events",b.queryFilter="now",b.queryCat=o,b.landmarksNow=c.landmarks.query({queryType:b.queryType,queryFilter:b.queryFilter,queryCat:b.queryCat,userTime:new Date},function(){g(b.landmarksNow[0]?b.landmarksNow[0].time.end:"noNow")}),b.filter=function(a,d){b.landmarks=c.landmarks.query({queryType:a,queryFilter:d})},b.goTalk=function(b){a.path("talk/"+b)},b.goTalkList=function(){a.path("talk")}}function ShowCtrl(a,b,c,d,e,f){shelfPan("return"),window.scrollTo(0,0),f.hideIFbar=!1,f.showNavIcons=!1,f.showMapNav=!1;var g=new Date,h=new Date("Jun 12 2014 15:59:59 GMT-0400 (EDT)");g>h?(b.showBootCamp=!1,b.showMoMA=!0):(b.showBootCamp=!0,b.showMoMA=!1),f.showBack=!1,f.showBackPage=!1,f.showBackMark=!1,f.showSwitch=!0,f.radioModel="Thursday",b.tweets=c.tweets.query({limit:1}),b.instagrams=c.instagrams.query({limit:1}),angular.extend(f,{center:{lat:40.76147,lng:-73.9778,zoom:19},tiles:tilesDict.aicp}),b.hideSwitch=function(){1==f.showSwitch?(f.showSwitch=!1,f.showMapNav=!0,f.showBack=!0,f.showNavIcons=!0,f.hideIFbar=!0):(f.showSwitch=!0,f.showMapNav=!1,f.showBack=!1,f.showNavIcons=!1,f.hideIFbar=!1)};var i={"1F":[40.7618,-73.978],"2F":[40.7612,-73.978],"5F":[40.7607,-73.978],GARDEN:[40.7619,-73.9771],EDUCATION:[40.761999,-73.9764]};f.mapPan=function(a){angular.extend(f,{center:{lat:i[a][0],lng:i[a][1],zoom:20},tiles:tilesDict.aicp})},f.goBack=function(){f.hideIFbar=!1,window.history.back()},b.goNow=function(){a.path("landmark/Kathryn_Gordon_Show")},b.shelfUpdate=function(a){b.shelfUpdate=b.shelfUpdate==a?"default":a},b.filter=function(a,d){b.landmarks=c.landmarks.query({queryType:a,queryFilter:d})},b.goTalk=function(b){a.path("talk/"+b)},b.goTalkList=function(){a.path("talk")};var j="'partial'";b.queryMap=function(a,b){window.scrollTo(0,0),f.singleModel=1,f.iconModel=b,c.landmarks.query({queryType:a,queryFilter:b},function(a){for(var b={},c=0;c<a.length;c++)"img/tidepools/default.jpg"==a[c].stats.avatar&&("bars"==a[c].subType&&(a[c].stats.avatar="img/AICP/icons/bar.png"),"exhibits"==a[c].subType&&(a[c].stats.avatar="img/AICP/icons/coolsculpt.png"),"food"==a[c].subType&&(a[c].stats.avatar="img/AICP/icons/food.png"),"smoking"==a[c].subType&&(a[c].stats.avatar="img/AICP/icons/smoking.png"),"washrooms"==a[c].subType&&(a[c].stats.avatar="img/AICP/icons/washrooms.png")),b[a[c].id]={lat:a[c].loc[0],lng:a[c].loc[1],message:"<a href=#/post/"+a[c].id+'/m><h4 onclick="shelfPan('+j+');"><img style="width:70px;" src="'+a[c].stats.avatar+'"> '+a[c].name+"</h4></a>",focus:!0,icon:local_icons.yellowIcon};angular.extend(f,{center:{lat:a[0].loc[0],lng:a[0].loc[1],zoom:18},markers:b,tiles:tilesDict.aicp})},function(){})},angular.extend(f,{markers:{}})}function LoginCtrl(a,b,c,d,e,f){b.showLogout&&d.url("/profile"),a.alerts=f,a.aperture=e,a.aperture.set("off"),a.user={},a.login=function(){var b={email:a.user.email,password:a.user.password};c.post("/api/user/login",b).success(function(a){a&&d.url("/profile")}).error(function(b){b&&a.alerts.addAlert("danger",b)})}}function SignupCtrl(a,b,c,d,e,f){a.alerts=f,a.aperture=e,a.aperture.set("off"),a.user={},a.signup=function(){var b={email:a.user.email,password:a.user.password};c.post("/api/user/signup",b).success(function(a){a&&d.url("/profile")}).error(function(b){b&&a.alerts.addAlert("danger",b)}),c.post("/api/user/signup",b).success(function(a){a&&d.url("/profile")}).error(function(b){b&&a.alerts.addAlert("danger",b)})}}function ForgotCtrl(a,b,c,d,e){a.alerts=e,a.aperture=d,a.aperture.set("off"),a.user={},a.sendForgot=function(){var c={email:a.user.email};b.post("/forgot",c).success(function(){a.alerts.addAlert("success","Instructions for resetting your password were emailed to you"),a.user.email=""}).error(function(b){b&&a.alerts.addAlert("danger",b)})}}function ResetCtrl(a,b,c,d,e,f){a.alerts=e,a.aperture=d,a.aperture.set("off"),b.post("/resetConfirm/"+f.token).success(function(){}).error(function(a){a&&c.path("/forgot")}),a.sendUpdatePassword=function(){var d={password:a.user.password};b.post("/reset/"+f.token,d).success(function(){c.path("/profile")}).error(function(b){b&&a.alerts.addAlert("danger",b)})}}function ProfileCtrl(a,b,c,d,e,f,g){a.aperture=e,a.aperture.set("off"),a.user={},a.worlds=[],a.deleteWorld=function(b){var c=confirm("Are you sure you want to delete this?");c&&f.del({_id:a.worlds[b]._id},function(c){a.worlds.splice(b,1)})},a.newWorld=function(){a.world.newStatus=!0,g.worlds.create(a.world,function(a){d.path("/edit/w/"+a[0].worldURL)})},c.get("/api/user/profile").success(function(b){a.worlds=b})}function EditController(a,b,c,d,e,f,g,h,i,j,k,l){function m(){navigator.geolocation&&!a.world.hasLoc&&navigator.geolocation.getCurrentPosition(n,o,{timeout:15e3})}function n(b){userLat=b.coords.latitude,userLng=b.coords.longitude,q.setCenter([userLng,userLat],17),q.removeAllMarkers(),q.addMarker("m",{lat:userLat,lng:userLng,message:"<p style='color:black;'>Drag to World's Location</p>",focus:!0,draggable:!0,icon:local_icons.yellowIcon});var c;switch(a.view){case"details":c="mask";break;case"maps":c="mask";break;case"styles":c="cover"}q.removeCircleMask(),q.addCircleMaskToMarker("m",150,c)}function o(){}var p=g,q=h,r=i,s=j,t=angular.element(".leaflet-bottom.leaflet-left")[0];t.style.top="50px",t.style.left="40%",p.set("full"),a.mapThemeSelect="arabesque",a.categories=[{name:"Convention"},{name:"Park"},{name:"Retail"},{name:"Venue"},{name:"Event"},{name:"Venue"},{name:"Campus"},{name:"Home"},{name:"Neighborhood"}],a.temp={scale:1},l.get("/components/edit/edit.locale-en-us.json").success(function(b){a.locale=angular.fromJson(b),a.tooltips=a.locale.tooltips}),a.view=f.view?f.view:"details",a.worldURL=f.worldURL;var u=e.current;a.initView=function(){switch(a.view){case"details":q.setCircleMaskState("mask");break;case"maps":q.setCircleMaskState("mask");break;case"styles":q.setCircleMaskState("cover")}},a.onWorldIconSelect=function(b){var c=b[0];a.upload=k.upload({url:"/api/upload/",file:c}).progress(function(a){}).success(function(b){a.world.avatar=b,a.uploadFinished=!0})},a.onLocalMapSelect=function(b){var c=b[0];a.upload=k.upload({url:"/api/upload_maps",file:c}).progress(function(a){}).success(function(b){a.mapImage=b,q.placeImage("m",b)})},a.selectMapTheme=function(b){var c={arabesque:{cloudMapName:"arabesque",cloudMapID:"interfacefoundry.ig67e7eb"},fairy:{cloudMapName:"fairy",cloudMapID:"interfacefoundry.ig9jd86b"},sunset:{cloudMapName:"sunset",cloudMapID:"interfacefoundry.ig6f6j6e"},urban:{cloudMapName:"urban",cloudMapID:"interfacefoundry.ig6a7dkn"}};"string"==typeof b&&(a.mapThemeSelect=b,q.setBaseLayer("https://{s}.tiles.mapbox.com/v3/"+c[b].cloudMapID+"/{z}/{x}/{y}.png"),a.world.style.maps.cloudMapName=c[b].cloudMapName,a.world.style.maps.cloudMapID=c[b].cloudMapID,0==a.style.hasOwnProperty("navBG_color")&&a.setThemeFromMap())},a.setThemeFromMap=function(){switch(a.world.style.maps.cloudMapName){case"urban":angular.extend(a.style,themeDict.urban);break;case"sunset":angular.extend(a.style,themeDict.sunset);break;case"fairy":angular.extend(a.style,themeDict.fairy);break;case"arabesque":angular.extend(a.style,themeDict.arabesque)}},a.addLandmarkCategory=function(){a.temp&&a.world.landmarkCategories.unshift({name:a.temp.LandmarkCategory})},a.removeLandmarkCategory=function(b){a.world.landmarkCategories.splice(b,1)},a.loadWorld=function(b){a.world=b.world,a.style=b.style,r.navBG_color=a.style.navBG_color,a.world.hasLoc?n({coords:{latitude:a.world.loc.coordinates[1],longitude:a.world.loc.coordinates[0]}}):m(),0==a.world.hasOwnProperty("style")&&(a.world.style={}),0==a.world.style.hasOwnProperty("maps")&&(a.world.style.maps={}),0==a.world.hasOwnProperty("landmarkCategories")&&(a.world.landmarkCategories=[]),a.world.style.maps.cloudMapName?(q.setBaseLayer(tilesDict[a.world.style.maps.cloudMapName].url),a.mapThemeSelect=a.world.style.maps.cloudMapName):a.selectMapTheme("arabesque"),a.style.bodyBG_color||(a.style.bodyBG_color="#FFFFFF",a.style.cardBG_color="#FFFFFF")
},a.saveWorld=function(){a.whenSaving=!0,a.world.newStatus=!1,a.world.hasLoc=!0,tempMarker=q.getMarker("m"),a.world.loc.coordinates[0]=tempMarker.lng,a.world.loc.coordinates[1]=tempMarker.lat,void 0==typeof a.world.style.maps&&(a.world.style.maps={}),b.worlds.create(a.world,function(b){a.world.id=b[0].id,a.whenSaving=!1,s.addAlert("success",'Save successful! Go to <a class="alert-link" target="_blank" href="#/w/'+a.world.id+'">'+a.world.name+"</a>",!0)}),b.styles.create(a.style,function(a){})},a.search=function(){var b=new google.maps.Geocoder;b&&b.geocode({address:a.searchText},function(a,b){b==google.maps.GeocoderStatus.OK&&n({coords:{latitude:a[0].geometry.location.lat(),longitude:a[0].geometry.location.lng()}})})},a.setStartTime=function(){var b=new Date;a.world.time.start=b.toISO8601String()},a.setEndTime=function(){var b=new Date;"string"==typeof a.world.time.start&&b.setISO8601(a.world.time.start),a.world.time.start instanceof Date&&(b=a.world.time.start),b.setUTCHours(b.getUTCHours()+3);var c=b;a.world.time.end=c.toISO8601String()},a.removePlaceImage=function(){a.mapImage=null,q.removePlaceImage()},a.buildLocalMap=function(){var b=q.getPlaceImageBounds(),c=b.getSouthEast(),d=b.getNorthWest(),e=b.getSouthWest(),f=b.getNorthEast(),g={worldID:a.world._id,nw_loc_lng:d.lng,nw_loc_lat:d.lat,sw_loc_lng:e.lng,sw_loc_lat:e.lat,ne_loc_lng:f.lng,ne_loc_lat:f.lat,se_loc_lng:c.lng,se_loc_lat:c.lat},h=JSON.stringify(g),i={mapIMG:a.mapImage,coords:h};s.addAlert("warning","Building local map, this may take some time!",!0),l.post("/api/build_map",i).success(function(b){s.addAlert("success","Map built!",!0),a.world.hasOwnProperty("style")||(a.world.style={}),a.world.style.hasOwnProperty("maps")||(a.world.style.maps={}),b[0]?(a.world.style.maps.localMapID=b[0].style.maps.localMapID,a.world.style.maps.localMapName=b[0].style.maps.localMapName,a.world.style.maps.localMapOptions=b[0].style.maps.localMapOptions):(a.world.style.maps.localMapID=b.style.maps.localMapID,a.world.style.maps.localMapName=b.style.maps.localMapName,a.world.style.maps.localMapOptions=b.style.maps.localMapOptions),a.saveWorld()})},a.$on("$locationChangeSuccess",function(){u.$$route.originalPath===e.current.$$route.originalPath&&(a.view=e.current.params.view,e.current=u),a.initView()}),a.$on("$destroy",function(b){b.targetScope===a&&(q.removeCircleMask(),q.removePlaceImage(),t.style&&(t.style.top="",t.style.left="")),angular.extend(d,{navTitle:""})}),a.$watch("style.navBG_color",function(a){r.navBG_color=a}),a.$watch("world.name",function(a){angular.extend(d,{navTitle:"Edit &raquo; "+a+" <a href='#/w/"+f.worldURL+"' class='preview-link' target='_blank'>Preview</a>"})}),a.$watch("temp.scale",function(a,b){a!=b&&q.setPlaceImageScale(a)}),c.get({id:f.worldURL},function(b){b.err||a.loadWorld(b),q.refresh()})}function WalkthroughController(a){a.progress=new Array(10).fill({test:"test"},0,10),a.walk={title:"something",caption:"what",length:7,position:0}}function WorldMakerCtrl(a,b,c,d,e,f,g,h,i){function j(){f.getMap("worldDetailMap").then(function(a){setTimeout(function(){a.invalidateSize()},400)})}function k(a){userLat=a.coords.latitude,userLon=a.coords.longitude,angular.extend(b,{center:{lat:userLat,lng:userLon,zoom:17},markers:{}}),b.center={lat:userLat,lng:userLon,zoom:17},b.tiles=tilesDict.mapbox,b.markers={m:{lat:userLat,lng:userLon,message:"<p style='color:black;'>Drag to Location on map</p>",focus:!0,draggable:!0,icon:local_icons.yellowIcon}},b.paths={worldBounds:{type:"circle",radius:150,latlngs:{lat:b.markers.m.lat,lng:b.markers.m.lng}}},b.$on("leafletDirectiveMap.moveend",function(){b.paths={worldBounds:{type:"circle",radius:150,latlngs:{lat:b.markers.m.lat,lng:b.markers.m.lng}}},j()}),angular.extend(e,{loading:!1}),j()}function l(){}function m(a){function c(a){var b=a,c=b.indexOf("T");return b.substring(0,-1!=c?c:b.length)}b.world.hasTime=b.showTime,b.showTime&&(b.world.date.end||(b.world.date.end=b.world.date.start),b.world.datetext={start:b.world.date.start,end:b.world.date.end},b.world.date.start=new Date(b.world.date.start).toISOString(),b.world.date.end=new Date(b.world.date.end).toISOString(),b.world.date.start=c(b.world.date.start),b.world.date.end=c(b.world.date.end),b.world.date.start=b.world.date.start.replace(/(\d+)-(\d+)-(\d+)/,"$2-$3-$1"),b.world.date.end=b.world.date.end.replace(/(\d+)-(\d+)-(\d+)/,"$2-$3-$1"),b.world.time.start||(b.world.time.start="00:00"),b.world.time.end||(b.world.time.end="23:59"),b.world.timetext={start:b.world.time.start,end:b.world.time.end}),b.world.userID=b.userID,"edit"==a&&(b.world.loc.coordinates=[b.markers.m.lng,b.markers.m.lat],b.world.newStatus=!1,b.world.worldID=b.worldID,d.worlds.create(b.world,function(a){})),"map"==a&&(b.mapping.editMap=!0,b.mapping.worldID=b.worldID,d.worlds.create(b.mapping,function(a){})),void 0===a&&(b.world.loc.coordinates=[b.markers.m.lng,b.markers.m.lat],b.world.newStatus=!0,d.worlds.create(b.world,function(a){b.worldID=a[0].worldID,b.projectID=a[0].projectID,b.styleID=a[0].styleID,b.worldURL=a[0].worldURL}))}function n(){b.styles.styleID=b.styleID,b.styles.worldID=b.worldID,b.styles.worldTag=b.world.hashtag,d.styles.create(b.styles,function(a){})}function j(){f.getMap("worldDetailMap").then(function(a){setTimeout(function(){a.invalidateSize()},400)})}var o=(f.getMap("worldDetailMap"),h);o.set("off"),angular.extend(e,{apertureSize:0}),angular.extend(e,{apertureOn:!1}),b.center={},b.tiles=tilesDict.mapbox,b.markers={},angular.extend(b,{paths:{}}),angular.extend(e,{loading:!0}),b.userID="53ab92d2ac23550e12600011",b.username="interfoundry",b.worldID,b.styleID,b.projectID,b.worldTag,b.pageIndex=0,b.pageClass=[],b.pageClass[0]="current",b.pageClass[1]="right",b.pageClass[2]="right",b.mapConfirm="false",b.world={loc:{},avatar:"img/tidepools/default.jpg",date:{},time:{},landmarkCategories:[]},b.mapping={},b.styles={},b.project={},b.mapThemes=[{cloudMapName:"urban",cloudMapID:"interfacefoundry.ig6a7dkn"},{cloudMapName:"fairy",cloudMapID:"interfacefoundry.ig9jd86b"},{cloudMapName:"sunset",cloudMapID:"interfacefoundry.ig6f6j6e"},{cloudMapName:"arabesque",cloudMapID:"interfacefoundry.ig67e7eb"}],b.mapping.mapThemeSelect=b.mapThemes[0],b.mapping.type="cloud",b.markerOptions=[{name:"red"},{name:"orange"},{name:"yellow"},{name:"green"},{name:"blue"},{name:"purple"}],b.categoryOptions=[{name:"Conference"},{name:"Meetup"},{name:"Party"}],b.typeOptions=[{name:"Place"},{name:"Event"}],b.mapping.markerSelect=b.markerOptions[0],b.bgColor="#CCC",b.showTime=!1,b.buildLocalMap=!1,$(".color").spectrum({clickoutFiresChange:!0,showInput:!0}),b.today=function(){b.world.date.start=new Date,b.world.time.start=new Date,b.world.time.end=new Date},b.today(),b.open=function(a){a.preventDefault(),a.stopPropagation(),b.opened=!0},b.format="MMMM dd, yyyy",b.hstep=1,b.mstep=15,b.ismeridian=!0,b.buildOut=function(){n(),a.path("/w/"+b.worldURL)},angular.element("#fileupload").fileupload({url:"/api/upload",dataType:"text",progressall:function(a,b){$("#progress .bar").css("width","0%");var c=parseInt(b.loaded/b.total*100,10);$("#progress .bar").css("width",c+"%")},done:function(a,c){$("#uploadedpic").html(""),$("#preview").html(""),$("<p/>").text("Saved: "+c.originalFiles[0].name).appendTo("#uploadedpic"),$('<img src="'+c.result+'">').load(function(){$(this).width(150).height(150).appendTo("#preview")}),b.world.avatar=c.result}}),b.nextPage=function(){if(b.worldDetail.worldName.$valid){if(b.pageIndex<b.pageClass.length-1){if(b.pageClass[b.pageIndex]="left",0==b.pageIndex&&(b.worldID?m("edit"):m()),1==b.pageIndex){switch(b.mapping.mapThemeSelect.cloudMapName){case"urban":angular.extend(b.styles,themeDict.urban);break;case"sunset":angular.extend(b.styles,themeDict.sunset);break;case"fairy":angular.extend(b.styles,themeDict.fairy);break;case"arabesque":angular.extend(b.styles,themeDict.arabesque)}b.buildLocalMap&&b.buildMap(),m("map")}2==b.pageIndex&&n(),b.pageIndex+=1,b.pageClass[b.pageIndex]="current"}}else window.alert("Add a name!")},b.prevPage=function(){b.pageIndex>0&&(b.pageClass[b.pageIndex]="right",b.pageIndex=b.pageIndex-1,b.pageClass[b.pageIndex]="current")},b.addLandmarkCategory=function(){b.world.landmarkCategories.unshift({name:b.tempLandmarkCategory})},b.removeLandmarkCategory=function(a){b.world.landmarkCategories.splice(a,1)},b.maplocsearch=function(a){if(13==a.keyCode||0==a.button){var c=new google.maps.Geocoder;c&&c.geocode({address:b.locsearchbar},function(a,c){c==google.maps.GeocoderStatus.OK&&(b.center.lat=a[0].geometry.location.lat(),b.center.lng=a[0].geometry.location.lng(),b.markers.m.lat=a[0].geometry.location.lat(),b.markers.m.lng=a[0].geometry.location.lng())})}},b.mapLock=function(){b.paths={worldBounds:{type:"circle",radius:150,latlngs:{lat:b.markers.m.lat,lng:b.markers.m.lng}}},j()},navigator.geolocation&&(navigator.geolocation.getCurrentPosition(k,l,{timeout:15e3}),j()),b.myData={link:"http://google.com",modalShown:!1,hello:"world",foo:"bar"},b.logClose=function(){},angular.extend(b,{layers:{baselayers:{osm:{name:"OpenStreetMap",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",type:"xyz"}}},markers:{}}),b.upload_panel=!0,b.upload_bar=!1,b.addOverlay=function(){b.upload_panel=!1,b.resetMap(),window.console.log("image uploaded to "+$("#preview_map").find("img").attr("src")),window.console.log("image width "+$("#preview_map").find("img").width()),window.console.log("image height "+$("#preview_map").find("img").height());var a=$("#preview_map").find("img").attr("src"),c=$("#preview_map").find("img").width(),d=$("#preview_map").find("img").height();f.getMap("modalMap").then(function(e){window.console.log("map found"),window.console.log(e),b.areaSelect=L.areaSelect({width:c,height:d,keepAspectRatio:!0}),b.areaSelect.addTo(e);var f=b.areaSelect.getBounds();window.console.log("area select added to map");var g=L.imageOverlay(a,f).addTo(e);window.console.log("image overlay added to map"),b.areaSelect.on("change",function(){e.removeLayer(g),g=L.imageOverlay(a,this.getBounds()).addTo(e)}),e.on("move",function(){this.removeLayer(g),g=L.imageOverlay(a,b.areaSelect.getBounds()).addTo(e)})})},b.resetMap=function(){f.getMap("modalMap").then(function(a){a.invalidateSize(),window.console.log("map reset fired")})},b.buildMap=function(){var a;b.showMapBuilding=!0,b.buildLocalMap=!1,f.getMap("modalMap").then(function(){var c=b.areaSelect.getBounds(),d=c.getSouthEast(),e=c.getNorthWest(),f=c.getSouthWest(),g=c.getNorthEast();a={worldID:b.worldID,nw_loc_lng:e.lng,nw_loc_lat:e.lat,sw_loc_lng:f.lng,sw_loc_lat:f.lat,ne_loc_lng:g.lng,ne_loc_lat:g.lat,se_loc_lng:d.lng,se_loc_lat:d.lat};var h=JSON.stringify(a),j={mapIMG:b.mapIMG,coords:h};i.post("/api/build_map",j).success(function(a){b.showMapBuilding=!1,b.showMapBuilt=!0,b.mapping.type="both"})})},angular.element("#fileuploadmap").fileupload({url:"/api/upload_maps",dataType:"text",progressall:function(a,b){$("#map_progress .bar").css("width","0%");var c=parseInt(b.loaded/b.total*100,10);$("#map_progress .bar").css("width",c+"%")},done:function(a,c){$("#uploaded_map").html(""),$("#preview_map").html(""),$("<p/>").text("Saved: "+c.originalFiles[0].name).appendTo("#uploaded_map"),$('<img src="'+c.result+'">').load(function(){$(this).appendTo("#preview_map").after(b.addOverlay())}),b.hideMapOptions=!0,b.buildLocalMap=!0,b.$parent.mapIMG=c.result}})}function LandmarkEditorController(a,b,c,d,e,f,g,h,i,j,k,l){function m(){f.landmarks.query({queryType:"all",queryFilter:"all",parentID:a.world._id},function(b){a.landmarks=a.landmarks.concat(b),angular.forEach(a.landmarks,function(a){o.addMarker(a._id,{lat:a.loc.coordinates[1],lng:a.loc.coordinates[0],draggable:!0,message:a.name})}),r=!0})}function n(){var b={name:"Landmark "+(a.landmarks.length+1),_id:0,world:!1,newStatus:!0,parentID:0,loc:{type:"Point",coordinates:[-74.0059,40.7127]},avatar:"img/tidepools/default.jpg"};return q&&(b.parentID=a.world._id,b.loc.coordinates=a.world.loc.coordinates),b}var o=j,p=angular.element(".leaflet-bottom.leaflet-left")[0];p.style.top="50px",p.style.left="40%";var q=!1,r=!1;a.landmarks=[],a.selectedIndex=0,a.alerts=l,a.addLandmark=function(){if(q&&r){var b=n();f.landmarks.create(b,function(c){b._id=c[0]._id,a.landmarks.unshift(b),o.addMarker(b._id,{lat:b.loc.coordinates[1],lng:b.loc.coordinates[0],draggable:!0})})}else;},a.removeItem=function(b){var c=confirm("Are you sure you want to delete this item?");c&&(o.removeMarker(a.landmarks[b]._id),k.del({_id:a.landmarks[b]._id},function(){a.landmarks.splice(b,1)}))},a.saveItem=function(b){a.landmarks[b].newStatus=!1;var c=o.getMarker(a.landmarks[b]._id);return 0==c?!1:(a.landmarks[b].loc.coordinates=[c.lng,c.lat],f.landmarks.create(a.landmarks[b],function(a){}),void a.alerts.addAlert("success","Landmark Saved",!0))},a.selectItem=function(b){a.selectedIndex=b,o.setCenter(a.landmarks[b].loc.coordinates,18),o.setMarkerMessage(a.landmarks[b]._id,a.landmarks[b].name),o.setMarkerFocus(a.landmarks[b]._id)},a.$on("$destroy",function(b){b.targetScope===a&&(o.removeCircleMask(),p.style&&(p.style.top="",p.style.left=""))}),g.get({id:e.worldURL},function(b){a.world=b.world,a.style=b.style,a.worldURL=e.worldURL,o.setBaseLayer(tilesDict[a.world.style.maps.cloudMapName].url),o.setCenter(a.world.loc.coordinates,18),o.addMarker("m",{lat:a.world.loc.coordinates[1],lng:a.world.loc.coordinates[0],focus:!1,draggable:!1,icon:{iconUrl:"",shadowUrl:"",iconSize:[0,0],shadowSize:[0,0],iconAnchor:[0,0],shadowAnchor:[0,0]}}),o.removeCircleMask(),o.addCircleMaskToMarker("m",150,"mask"),o.setMaxBoundsFromPoint([a.world.loc.coordinates[1],a.world.loc.coordinates[0]],.05),("local"==a.world.style.maps.type||"both"==a.world.style.maps.type)&&o.addOverlay(a.world.style.maps.localMapID,a.world.style.maps.localMapName,a.world.style.maps.localMapOptions),o.refresh(),q=!0,m()})}function LandmarkEditorItemController(a,b,c,d,e){a.time=!1,a.deleteLandmark=function(){a.$parent.removeItem(a.$index)},a.saveLandmark=function(){a.$parent.saveItem(a.$index)},a.selectLandmark=function(){a.$parent.selectItem(a.$index)},a.setStartTime=function(){var b=new Date;a.$parent.landmark.time.start=b.toISO8601String()},a.setEndTime=function(){var b=new Date;"string"==typeof a.$parent.landmark.time.start&&b.setISO8601(a.$parent.landmark.time.start),a.$parent.landmark.time.start instanceof Date&&(b=a.$parent.landmark.time.start),b.setUTCHours(b.getUTCHours()+3);var c=b;a.$parent.landmark.time.end=c.toISO8601String()},a.onUploadAvatar=function(b){var c=b[0];a.upload=e.upload({url:"/api/upload/",file:c}).progress(function(a){}).success(function(b){a.$parent.landmark.avatar=b,a.uploadFinished=!0})}}function SearchController(){}function CategoryController(a,b,c,d,e,f,g,h,i,j,k){function l(){m.removeAllMarkers(),e.landmarks=[],b.landmarks.query({queryType:"all",queryFilter:"all",parentID:e.world._id},function(a){angular.forEach(a,function(a){a.category==e.category&&(e.landmarks.push(a),m.addMarker(a._id,{lat:a.loc.coordinates[1],lng:a.loc.coordinates[0],draggable:!1,message:a.name}))})})}var m=j;e.worldURL=d.worldURL,e.category=d.category,e.aperture=i,e.aperture.set("full"),e.landmarks=[];var n=c.current;e.$on("$locationChangeSuccess",function(){n.$$route.originalPath===c.current.$$route.originalPath&&(e.category=c.current.params.category,c.current=n,l())}),a.get({id:e.worldURL},function(a){e.world=a.world,e.style=a.style,m.setMaxBoundsFromPoint([e.world.loc.coordinates[1],e.world.loc.coordinates[0]],.05),m.setCenter(e.world.loc.coordinates,17),l()})}function LandmarkController(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){p.setCenter(e.landmark.loc.coordinates,20);var a=p.markers;angular.forEach(a,function(a){p.removeMarker(a._id)}),p.addMarker(e.landmark._id,{lat:e.landmark.loc.coordinates[1],lng:e.landmark.loc.coordinates[0],draggable:!1,message:e.landmark.name,_id:e.landmark._id}),p.setMarkerFocus(e.landmark._id)}var o=angular.element(".leaflet-bottom.leaflet-left")[0];o.style.top="100px",o.style.left="1%";var p=l,q=m;e.aperture=k,e.aperture.set("half"),e.worldURL=d.worldURL,e.landmarkURL=d.landmarkURL,e.landmark=b.get({id:d.landmarkURL},function(a){n()}),a.get({id:d.worldURL},function(a){a.err?(g.error(a.err),f.path("/#/")):(e.world=a.world,e.style=a.style,q.navBG_color=e.style.navBG_color)}),p.refresh()}function WorldController(a,b,c,d,e,f,g,h,i,j){function k(){d.lookup={};for(var a=0,b=d.landmarks.length;b>a;a++)d.lookup[d.landmarks[a]._id]=a}function l(a){d.upcoming=[];for(var b=0,c=a.length;c>b;b++)d.upcoming[b]=d.landmarks.splice(d.lookup[a[b]._id],1)[0]}function m(){if(d.style.widgets&&(d.style.widgets.twitter&&(d.twitter=!0),d.style.widgets.instagram&&(d.instagram=!0),"StartFast_Demo_Day_2014"==d.world.id&&(d.wyzerr=!0),d.style.widgets.category&&(d.category=!0),d.style.widgets.upcoming)){d.upcoming=!0;var a=new Date;b.landmarks.query({queryFilter:"now",parentID:d.world._id,userTime:a},function(a){a[0]&&(d.now=d.landmarks.splice(d.lookup[a[0]._id],1)[0])}),b.landmarks.query({queryFilter:"upcoming",parentID:d.world._id,userTime:a},function(a){l(a)})}d.world.resources&&(d.tweets=b.tweets.query({limit:1,tag:d.world.resources.hashtag}),d.instagrams=b.instagrams.query({limit:1,tag:d.world.resources.hashtag}))}function n(){angular.forEach(d.landmarks,function(a){p.addMarker(a._id,{lat:a.loc.coordinates[1],lng:a.loc.coordinates[0],draggable:!1,message:'<a href="#/w/'+d.world.id+"/"+a.id+'">'+a.name+"</a>",icon:{},_id:a._id})})}var o=angular.element(".leaflet-bottom.leaflet-left")[0];o.style.top="60px",o.style.left="1%";var p=i,q=j;d.worldURL=c.worldURL,d.aperture=h,d.aperture.set("off"),angular.extend(g,{loading:!1}),d.selectedIndex=0;d.filterCategory=function(a){d.aperture.set("half"),redoMarkers(d.landmarks,a)},d.returnToWorld=function(){redoMarkers(d.landmarks)},d.loadWorld=function(a){d.world=a.world,d.style=a.style,q.navBG_color=d.style.navBG_color,d.world.name&&angular.extend(g,{globalTitle:d.world.name}),(d.world.description||d.world.summary)&&(d.description=!0,d.descriptionType=d.world.description?"description":"summary");var b=19;d.world.style.hasOwnProperty("maps")&&d.world.style.maps.hasOwnProperty("localMapOptions")&&(b=d.world.style.maps.localMapOptions.maxZoom||19),p.setCenter([d.world.loc.coordinates[0],d.world.loc.coordinates[1]],b),p.setBaseLayer(tilesDict[d.world.style.maps.cloudMapName].url),d.world.style.maps.localMapID&&(p.addOverlay(d.world.style.maps.localMapID,d.world.style.maps.localMapName,d.world.style.maps.localMapOptions),p.refresh()),d.loadLandmarks()},d.loadLandmarks=function(){b.landmarks.query({queryFilter:"all",parentID:d.world._id},function(a){d.landmarks=a,k(),m(),n(d.landmarks)})},a.get({id:c.worldURL},function(a){a.err?e.path("/#/"):d.loadWorld(a)})}function WorldRepeatController(){}function UpcomingController(){}LandmarkNewCtrl.$inject=["$location","$scope","$routeParams","db","$rootScope"],LandmarkEditCtrl.$inject=["Landmark","$location","$scope","$routeParams","db","$timeout","$rootScope"],WorldEditCtrl.$inject=["$location","$scope","db"],UserViewCtrl.$inject=["$location","$scope","db"],function(){"use strict";angular.module("leaflet-directive",[]).directive("leaflet",["$q","leafletData","leafletMapDefaults","leafletHelpers","leafletEvents",function(a,b,c,d,e){var f;return{restrict:"EA",replace:!0,scope:{center:"=center",defaults:"=defaults",maxbounds:"=maxbounds",bounds:"=bounds",markers:"=markers",legend:"=legend",geojson:"=geojson",paths:"=paths",tiles:"=tiles",layers:"=layers",controls:"=controls",decorations:"=decorations",eventBroadcast:"=eventBroadcast"},transclude:!0,template:'<div class="angular-leaflet-map"><div ng-transclude></div></div>',controller:["$scope",function(b){f=a.defer(),this.getMap=function(){return f.promise},this.getLeafletScope=function(){return b}}],link:function(a,g,h){var i=d.isDefined,j=c.setDefaults(a.defaults,h.id),k=e.genDispatchMapEvent,l=e.getAvailableMapEvents();i(h.width)&&(isNaN(h.width)?g.css("width",h.width):g.css("width",h.width+"px")),i(h.height)&&(isNaN(h.height)?g.css("height",h.height):g.css("height",h.height+"px"));var m=new L.Map(g[0],c.getMapCreationDefaults(h.id));if(f.resolve(m),i(h.center)||m.setView([j.center.lat,j.center.lng],j.center.zoom),!i(h.tiles)&&!i(h.layers)){var n=L.tileLayer(j.tileLayer,j.tileLayerOptions);n.addTo(m),b.setTiles(n,h.id)}if(i(m.zoomControl)&&i(j.zoomControlPosition)&&m.zoomControl.setPosition(j.zoomControlPosition),i(m.zoomControl)&&j.zoomControl===!1&&m.zoomControl.removeFrom(m),i(m.zoomsliderControl)&&i(j.zoomsliderControl)&&j.zoomsliderControl===!1&&m.zoomsliderControl.removeFrom(m),!i(h.eventBroadcast))for(var o="broadcast",p=0;p<l.length;p++){var q=l[p];m.on(q,k(a,q,o),{eventName:q})}m.whenReady(function(){b.setMap(m,h.id)}),a.$on("$destroy",function(){b.unresolveMap(h.id)})}}}]),angular.module("leaflet-directive").directive("center",["$log","$q","$location","leafletMapDefaults","leafletHelpers","leafletBoundsHelpers","leafletEvents",function(a,b,c,d,e,f,g){var h,i=e.isDefined,j=e.isNumber,k=e.isSameCenterOnMap,l=e.safeApply,m=e.isValidCenter,n=e.isEmpty,o=e.isUndefinedOrEmpty,p=function(a,b){return i(a)&&!n(a)&&o(b)};return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:function(){h=b.defer(),this.getCenter=function(){return h.promise}},link:function(b,e,n,o){var q=o.getLeafletScope(),r=q.center;o.getMap().then(function(b){var e=d.getDefaults(n.id);if(-1!==n.center.search("-"))return a.error('The "center" variable can\'t use a "-" on his key name: "'+n.center+'".'),void b.setView([e.center.lat,e.center.lng],e.center.zoom);if(p(q.bounds,r))b.fitBounds(f.createLeafletBounds(q.bounds)),r=b.getCenter(),l(q,function(a){a.center={lat:b.getCenter().lat,lng:b.getCenter().lng,zoom:b.getZoom(),autoDiscover:!1}}),l(q,function(a){var c=b.getBounds(),d={northEast:{lat:c._northEast.lat,lng:c._northEast.lng},southWest:{lat:c._southWest.lat,lng:c._southWest.lng}};a.bounds=d});else{if(!i(r))return a.error('The "center" property is not defined in the main scope'),void b.setView([e.center.lat,e.center.lng],e.center.zoom);i(r.lat)&&i(r.lng)||i(r.autoDiscover)||angular.copy(e.center,r)}var o,s;if("yes"===n.urlHashCenter){var t=function(){var a,b=c.search();if(i(b.c)){var d=b.c.split(":");3===d.length&&(a={lat:parseFloat(d[0]),lng:parseFloat(d[1]),zoom:parseInt(d[2],10)})}return a};o=t(),q.$on("$locationChangeSuccess",function(a){var c=a.currentScope,d=t();i(d)&&!k(d,b)&&(c.center={lat:d.lat,lng:d.lng,zoom:d.zoom})})}q.$watch("center",function(c){return i(o)&&(angular.copy(o,c),o=void 0),m(c)||c.autoDiscover===!0?c.autoDiscover===!0?(j(c.zoom)||b.setView([e.center.lat,e.center.lng],e.center.zoom),void b.locate(j(c.zoom)&&c.zoom>e.center.zoom?{setView:!0,maxZoom:c.zoom}:i(e.maxZoom)?{setView:!0,maxZoom:e.maxZoom}:{setView:!0})):void(s&&k(c,b)||(b.setView([c.lat,c.lng],c.zoom),g.notifyCenterChangedToBounds(q,b))):void a.warn("[AngularJS - Leaflet] invalid 'center'")},!0),b.whenReady(function(){s=!0}),b.on("moveend",function(){h.resolve(),g.notifyCenterUrlHashChanged(q,b,n,c.search()),k(r,b)||l(q,function(a){a.center={lat:b.getCenter().lat,lng:b.getCenter().lng,zoom:b.getZoom(),autoDiscover:!1},g.notifyCenterChangedToBounds(q,b)})}),r.autoDiscover===!0&&b.on("locationerror",function(){a.warn("[AngularJS - Leaflet] The Geolocation API is unauthorized on this page."),m(r)?(b.setView([r.lat,r.lng],r.zoom),g.notifyCenterChangedToBounds(q,b)):(b.setView([e.center.lat,e.center.lng],e.center.zoom),g.notifyCenterChangedToBounds(q,b))})})}}}]),angular.module("leaflet-directive").directive("tiles",["$log","leafletData","leafletMapDefaults","leafletHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,f,g,h){var i=d.isDefined,j=h.getLeafletScope(),k=j.tiles;return i(k)||i(k.url)?void h.getMap().then(function(a){var d,e=c.getDefaults(g.id);j.$watch("tiles",function(c){var f=e.tileLayerOptions,h=e.tileLayer;return!i(c.url)&&i(d)?void a.removeLayer(d):i(d)?i(c.url)&&i(c.options)&&!angular.equals(c.options,f)?(a.removeLayer(d),f=e.tileLayerOptions,angular.copy(c.options,f),h=c.url,d=L.tileLayer(h,f),d.addTo(a),void b.setTiles(d,g.id)):void(i(c.url)&&d.setUrl(c.url)):(i(c.options)&&angular.copy(c.options,f),i(c.url)&&(h=c.url),d=L.tileLayer(h,f),d.addTo(a),void b.setTiles(d,g.id))},!0)}):void a.warn("[AngularJS - Leaflet] The 'tiles' definition doesn't have the 'url' property.")}}}]),angular.module("leaflet-directive").directive("legend",["$log","$http","leafletHelpers","leafletLegendHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(e,f,g,h){var i,j=c.isArray,k=c.isDefined,l=c.isFunction,m=h.getLeafletScope(),n=m.legend,o=n.legendClass?n.legendClass:"legend",p=n.position||"bottomright";h.getMap().then(function(c){m.$watch("legend",function(b){k(b.url)||j(b.colors)&&j(b.labels)&&b.colors.length===b.labels.length?k(b.url)?a.info("[AngularJS - Leaflet] loading arcgis legend service."):(i=L.control({position:p}),i.onAdd=d.getOnAddArrayLegend(b,o),i.addTo(c)):a.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set.")}),m.$watch("legend.url",function(e){k(e)&&b.get(e).success(function(a){k(i)?d.updateArcGISLegend(i.getContainer(),a):(i=L.control({position:p}),i.onAdd=d.getOnAddArcGISLegend(a,o),i.addTo(c)),k(n.loadedData)&&l(n.loadedData)&&n.loadedData()}).error(function(){a.warn("[AngularJS - Leaflet] legend.url not loaded.")})})})}}}]),angular.module("leaflet-directive").directive("geojson",["$log","$rootScope","leafletData","leafletHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(a,e,f,g){var h=d.safeApply,i=d.isDefined,j=g.getLeafletScope(),k={};g.getMap().then(function(a){j.$watch("geojson",function(e){if(i(k)&&a.hasLayer(k)&&a.removeLayer(k),i(e)&&i(e.data)){var f=e.resetStyleOnMouseout,g=e.onEachFeature;g||(g=function(a,c){d.LabelPlugin.isLoaded()&&i(e.label)&&c.bindLabel(a.properties.description),c.on({mouseover:function(c){h(j,function(){e.selected=a,b.$broadcast("leafletDirectiveMap.geojsonMouseover",c)})},mouseout:function(a){f&&k.resetStyle(a.target),h(j,function(){e.selected=void 0,b.$broadcast("leafletDirectiveMap.geojsonMouseout",a)})},click:function(c){h(j,function(){e.selected=a,b.$broadcast("leafletDirectiveMap.geojsonClick",e.selected,c)})}})}),e.options={style:e.style,filter:e.filter,onEachFeature:g,pointToLayer:e.pointToLayer},k=L.geoJson(e.data,e.options),c.setGeoJSON(k),k.addTo(a)}})})}}}]),angular.module("leaflet-directive").directive("layers",["$log","$q","leafletData","leafletHelpers","leafletLayerHelpers","leafletControlHelpers",function(a,b,c,d,e,f){var g;return{restrict:"A",scope:!1,replace:!1,require:"leaflet",controller:function(){g=b.defer(),this.getLayers=function(){return g.promise}},link:function(b,h,i,j){var k=d.isDefined,l={},m=j.getLeafletScope(),n=m.layers,o=e.createLayer,p=f.updateLayersControl,q=!1;j.getMap().then(function(b){if(!k(n)||!k(n.baselayers)||0===Object.keys(n.baselayers).length)return void a.error("[AngularJS - Leaflet] At least one baselayer has to be defined");g.resolve(l),c.setLayers(l,i.id),l.baselayers={},l.overlays={};var d=i.id,e=!1;for(var f in n.baselayers){var h=o(n.baselayers[f]);k(h)?(l.baselayers[f]=h,n.baselayers[f].top===!0&&(b.addLayer(l.baselayers[f]),e=!0)):delete n.baselayers[f]}!e&&Object.keys(l.baselayers).length>0&&b.addLayer(l.baselayers[Object.keys(n.baselayers)[0]]);for(f in n.overlays){var j=o(n.overlays[f]);k(j)?(l.overlays[f]=j,n.overlays[f].visible===!0&&b.addLayer(l.overlays[f])):delete n.overlays[f]}m.$watch("layers.baselayers",function(c){for(var e in l.baselayers)k(c[e])||(b.hasLayer(l.baselayers[e])&&b.removeLayer(l.baselayers[e]),delete l.baselayers[e]);for(var f in c)if(!k(l.baselayers[f])){var g=o(c[f]);k(g)&&(l.baselayers[f]=g,c[f].top===!0&&b.addLayer(l.baselayers[f]))}if(0===Object.keys(l.baselayers).length)return void a.error("[AngularJS - Leaflet] At least one baselayer has to be defined");var h=!1;for(var i in l.baselayers)if(b.hasLayer(l.baselayers[i])){h=!0;break}h||b.addLayer(l.baselayers[Object.keys(n.baselayers)[0]]),q=p(b,d,q,c,n.overlays,l)},!0),m.$watch("layers.overlays",function(a){for(var c in l.overlays)k(a[c])||(b.hasLayer(l.overlays[c])&&b.removeLayer(l.overlays[c]),delete l.overlays[c]);for(var e in a){if(!k(l.overlays[e])){var f=o(a[e]);k(f)&&(l.overlays[e]=f,a[e].visible===!0&&b.addLayer(l.overlays[e]))}a[e].visible&&!b.hasLayer(l.overlays[e])?b.addLayer(l.overlays[e]):a[e].visible===!1&&b.hasLayer(l.overlays[e])&&b.removeLayer(l.overlays[e])}q=p(b,d,q,n.baselayers,a,l)},!0)})}}}]),angular.module("leaflet-directive").directive("bounds",["$log","$timeout","leafletHelpers","leafletBoundsHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,require:["leaflet","center"],link:function(b,e,f,g){var h=c.isDefined,i=d.createLeafletBounds,j=g[0].getLeafletScope(),k=g[0],l=function(a){return 0===a._southWest.lat&&0===a._southWest.lng&&0===a._northEast.lat&&0===a._northEast.lng?!0:!1};k.getMap().then(function(b){j.$on("boundsChanged",function(a){var c=a.currentScope,d=b.getBounds();if(!l(d)){var e={northEast:{lat:d._northEast.lat,lng:d._northEast.lng},southWest:{lat:d._southWest.lat,lng:d._southWest.lng}};angular.equals(c.bounds,e)||(c.bounds=e)}}),j.$watch("bounds",function(c){if(!h(c))return void a.error("[AngularJS - Leaflet] Invalid bounds");var d=i(c);d&&!b.getBounds().equals(d)&&b.fitBounds(d)},!0)})}}}]),angular.module("leaflet-directive").directive("markers",["$log","$rootScope","$q","leafletData","leafletHelpers","leafletMapDefaults","leafletMarkersHelpers","leafletEvents",function(a,b,c,d,e,f,g,h){return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(b,f,i,j){var k=j[0],l=e,m=e.isDefined,n=e.isString,o=k.getLeafletScope(),p=g.deleteMarker,q=g.addMarkerWatcher,r=g.listenMarkerEvents,s=g.addMarkerToGroup,t=h.bindMarkerEvents,u=g.createMarker;k.getMap().then(function(b){var e,f={};e=m(j[1])?j[1].getLayers:function(){var a=c.defer();return a.resolve(),a.promise},e().then(function(c){d.setMarkers(f,i.id),o.$watch("markers",function(d){for(var e in f)m(d)&&m(d[e])||(p(f[e],b,c),delete f[e]);for(var g in d)if(-1===g.search("-")){if(!m(f[g])){var h=d[g],j=u(h);if(!m(j)){a.error("[AngularJS - Leaflet] Received invalid data on the marker "+g+".");continue}if(f[g]=j,m(h.message)&&j.bindPopup(h.message,h.popupOptions),m(h.group)&&s(j,h.group,b),l.LabelPlugin.isLoaded()&&m(h.label)&&m(h.label.message)&&j.bindLabel(h.label.message,h.label.options),m(h)&&m(h.layer)){if(!n(h.layer)){a.error("[AngularJS - Leaflet] A layername must be a string");continue}if(!m(c)){a.error("[AngularJS - Leaflet] You must add layers to the directive if the markers are going to use this functionality.");continue}if(!m(c.overlays)||!m(c.overlays[h.layer])){a.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"');continue}var k=c.overlays[h.layer];if(!(k instanceof L.LayerGroup||k instanceof L.FeatureGroup)){a.error('[AngularJS - Leaflet] Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"');continue}k.addLayer(j),b.hasLayer(j)&&h.focus===!0&&j.openPopup()}else m(h.group)||(b.addLayer(j),h.focus===!0&&j.openPopup(),l.LabelPlugin.isLoaded()&&m(h.label)&&m(h.label.options)&&h.label.options.noHide===!0&&j.showLabel());var v=!m(i.watchMarkers)||"true"===i.watchMarkers;v&&(q(j,g,o,c,b),r(j,h,o)),t(j,g,h,o)}}else a.error('The marker can\'t use a "-" on his key name: "'+g+'".')},!0)})})}}}]),angular.module("leaflet-directive").directive("paths",["$log","$q","leafletData","leafletMapDefaults","leafletHelpers","leafletPathsHelpers","leafletEvents",function(a,b,c,d,e,f,g){return{restrict:"A",scope:!1,replace:!1,require:["leaflet","?layers"],link:function(h,i,j,k){var l=k[0],m=e.isDefined,n=e.isString,o=l.getLeafletScope(),p=o.paths,q=f.createPath,r=g.bindPathEvents,s=f.setPathOptions;l.getMap().then(function(f){var g,h=d.getDefaults(j.id);g=m(k[1])?k[1].getLayers:function(){var a=b.defer();return a.resolve(),a.promise},m(p)&&g().then(function(b){var d={};
c.setPaths(d,j.id);var g=function(a,b){var c=o.$watch("paths."+b,function(b){return m(b)?void s(a,b.type,b):(f.removeLayer(a),void c())},!0)};o.$watch("paths",function(c){for(var i in c)if(0!==i.search("\\$"))if(-1===i.search("-")){if(!m(d[i])){var j=c[i],k=q(i,c[i],h);if(m(k)&&m(j.message)&&k.bindPopup(j.message),e.LabelPlugin.isLoaded()&&m(j.label)&&m(j.label.message)&&k.bindLabel(j.label.message,j.label.options),m(j)&&m(j.layer)){if(!n(j.layer)){a.error("[AngularJS - Leaflet] A layername must be a string");continue}if(!m(b)){a.error("[AngularJS - Leaflet] You must add layers to the directive if the markers are going to use this functionality.");continue}if(!m(b.overlays)||!m(b.overlays[j.layer])){a.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"');continue}var l=b.overlays[j.layer];if(!(l instanceof L.LayerGroup||l instanceof L.FeatureGroup)){a.error('[AngularJS - Leaflet] Adding a marker to an overlay needs a overlay of the type "group" or "featureGroup"');continue}d[i]=k,l.addLayer(k),g(k,i)}else m(k)&&(d[i]=k,f.addLayer(k),g(k,i));r(k,i,j,o)}}else a.error('[AngularJS - Leaflet] The path name "'+i+'" is not valid. It must not include "-" and a number.');for(var p in d)m(c[p])||delete d[p]})},!0)})}}}]),angular.module("leaflet-directive").directive("controls",["$log","leafletHelpers",function(a,b){return{restrict:"A",scope:!1,replace:!1,require:"?^leaflet",link:function(a,c,d,e){if(e){var f=b.isDefined,g=e.getLeafletScope(),h=g.controls;e.getMap().then(function(a){if(f(L.Control.Draw)&&f(h.draw)){var b=new L.FeatureGroup;a.addLayer(b);var c={edit:{featureGroup:b}};angular.extend(c,h.draw.options);var d=new L.Control.Draw(c);a.addControl(d)}if(f(h.custom))for(var e in h.custom)a.addControl(h.custom[e])})}}}}]),angular.module("leaflet-directive").directive("eventBroadcast",["$log","$rootScope","leafletHelpers","leafletEvents",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(b,e,f,g){var h=c.isObject,i=g.getLeafletScope(),j=i.eventBroadcast,k=d.getAvailableMapEvents(),l=d.genDispatchMapEvent;g.getMap().then(function(b){var c,d,e=[],f="broadcast";if(h(j)){if(void 0===j.map||null===j.map)e=k;else if("object"!=typeof j.map)a.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model.");else{void 0!==j.map.logic&&null!==j.map.logic&&("emit"!==j.map.logic&&"broadcast"!==j.map.logic?a.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===j.map.logic&&(f="emit"));var g=!1,m=!1;if(void 0!==j.map.enable&&null!==j.map.enable&&"object"==typeof j.map.enable&&(g=!0),void 0!==j.map.disable&&null!==j.map.disable&&"object"==typeof j.map.disable&&(m=!0),g&&m)a.warn("[AngularJS - Leaflet] can not enable and disable events at the time");else if(g||m)if(g)for(c=0;c<j.map.enable.length;c++)d=j.map.enable[c],-1!==e.indexOf(d)?a.warn("[AngularJS - Leaflet] This event "+d+" is already enabled"):-1===k.indexOf(d)?a.warn("[AngularJS - Leaflet] This event "+d+" does not exist"):e.push(d);else for(e=k,c=0;c<j.map.disable.length;c++){d=j.map.disable[c];var n=e.indexOf(d);-1===n?a.warn("[AngularJS - Leaflet] This event "+d+" does not exist or has been already disabled"):e.splice(n,1)}else a.warn("[AngularJS - Leaflet] must enable or disable events")}for(c=0;c<e.length;c++)d=e[c],b.on(d,l(i,d,f),{eventName:d})}else a.warn("[AngularJS - Leaflet] event-broadcast must be an object, check your model.")})}}}]),angular.module("leaflet-directive").directive("maxbounds",["$log","leafletMapDefaults","leafletBoundsHelpers",function(a,b,c){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(a,b,d,e){var f=e.getLeafletScope(),g=c.isValidBounds;e.getMap().then(function(a){f.$watch("maxbounds",function(b){if(!g(b))return void a.setMaxBounds();var c=[[b.southWest.lat,b.southWest.lng],[b.northEast.lat,b.northEast.lng]];a.setMaxBounds(c),a.fitBounds(c)})})}}}]),angular.module("leaflet-directive").directive("decorations",["$log","leafletHelpers",function(a,b){return{restrict:"A",scope:!1,replace:!1,require:"leaflet",link:function(c,d,e,f){function g(b){return k(b)&&k(b.coordinates)&&(j.isLoaded()||a.error("[AngularJS - Leaflet] The PolylineDecorator Plugin is not loaded.")),L.polylineDecorator(b.coordinates)}function h(a,b){return k(a)&&k(b)&&k(b.coordinates)&&k(b.patterns)?(a.setPaths(b.coordinates),a.setPatterns(b.patterns),a):void 0}var i=f.getLeafletScope(),j=b.PolylineDecoratorPlugin,k=b.isDefined,l={};f.getMap().then(function(a){i.$watch("decorations",function(b){for(var c in l)k(b)&&k(b[c])||delete l[c],a.removeLayer(l[c]);for(var d in b){var e=b[d],f=g(e);k(f)&&(l[d]=f,a.addLayer(f),h(f,e))}},!0)})}}}]),angular.module("leaflet-directive").service("leafletData",["$log","$q","leafletHelpers",function(a,b,c){var d=c.getDefer,e=c.getUnresolvedDefer,f=c.setResolvedDefer,g={},h={},i={},j={},k={},l={},m={};this.setMap=function(a,b){var c=e(g,b);c.resolve(a),f(g,b)},this.getMap=function(a){var b=d(g,a);return b.promise},this.unresolveMap=function(a){var b=c.obtainEffectiveMapId(g,a);g[b]=void 0},this.getPaths=function(a){var b=d(j,a);return b.promise},this.setPaths=function(a,b){var c=e(j,b);c.resolve(a),f(j,b)},this.getMarkers=function(a){var b=d(k,a);return b.promise},this.setMarkers=function(a,b){var c=e(k,b);c.resolve(a),f(k,b)},this.getLayers=function(a){var b=d(i,a);return b.promise},this.setLayers=function(a,b){var c=e(i,b);c.resolve(a),f(i,b)},this.setTiles=function(a,b){var c=e(h,b);c.resolve(a),f(h,b)},this.getTiles=function(a){var b=d(h,a);return b.promise},this.setGeoJSON=function(a,b){var c=e(l,b);c.resolve(a),f(l,b)},this.getGeoJSON=function(a){var b=d(l,a);return b.promise},this.setDecorations=function(a,b){var c=e(m,b);c.resolve(a),f(m,b)},this.getDecorations=function(a){var b=d(m,a);return b.promise}}]),angular.module("leaflet-directive").factory("leafletMapDefaults",["$q","leafletHelpers",function(a,b){function c(){return{keyboard:!0,dragging:!0,worldCopyJump:!1,doubleClickZoom:!0,scrollWheelZoom:!0,zoomControl:!0,zoomsliderControl:!1,zoomControlPosition:"topleft",attributionControl:!0,controls:{layers:{visible:!0,position:"topright",collapsed:!0}},crs:L.CRS.EPSG3857,tileLayer:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}var d=b.isDefined,e=b.isObject,f=b.obtainEffectiveMapId,g={};return{getDefaults:function(a){var b=f(g,a);return g[b]},getMapCreationDefaults:function(a){var b=f(g,a),c=g[b],e={maxZoom:c.maxZoom,keyboard:c.keyboard,dragging:c.dragging,zoomControl:c.zoomControl,doubleClickZoom:c.doubleClickZoom,scrollWheelZoom:c.scrollWheelZoom,attributionControl:c.attributionControl,worldCopyJump:c.worldCopyJump,crs:c.crs};if(d(c.minZoom)&&(e.minZoom=c.minZoom),d(c.zoomAnimation)&&(e.zoomAnimation=c.zoomAnimation),d(c.fadeAnimation)&&(e.fadeAnimation=c.fadeAnimation),d(c.markerZoomAnimation)&&(e.markerZoomAnimation=c.markerZoomAnimation),c.map)for(var h in c.map)e[h]=c.map[h];return e},setDefaults:function(a,b){var h=c();d(a)&&(h.doubleClickZoom=d(a.doubleClickZoom)?a.doubleClickZoom:h.doubleClickZoom,h.scrollWheelZoom=d(a.scrollWheelZoom)?a.scrollWheelZoom:h.doubleClickZoom,h.zoomControl=d(a.zoomControl)?a.zoomControl:h.zoomControl,h.zoomsliderControl=d(a.zoomsliderControl)?a.zoomsliderControl:h.zoomsliderControl,h.attributionControl=d(a.attributionControl)?a.attributionControl:h.attributionControl,h.tileLayer=d(a.tileLayer)?a.tileLayer:h.tileLayer,h.zoomControlPosition=d(a.zoomControlPosition)?a.zoomControlPosition:h.zoomControlPosition,h.keyboard=d(a.keyboard)?a.keyboard:h.keyboard,h.dragging=d(a.dragging)?a.dragging:h.dragging,d(a.controls)&&angular.extend(h.controls,a.controls),e(a.crs)?h.crs=a.crs:d(L.CRS[a.crs])&&(h.crs=L.CRS[a.crs]),d(a.tileLayerOptions)&&angular.copy(a.tileLayerOptions,h.tileLayerOptions),d(a.maxZoom)&&(h.maxZoom=a.maxZoom),d(a.minZoom)&&(h.minZoom=a.minZoom),d(a.zoomAnimation)&&(h.zoomAnimation=a.zoomAnimation),d(a.fadeAnimation)&&(h.fadeAnimation=a.fadeAnimation),d(a.markerZoomAnimation)&&(h.markerZoomAnimation=a.markerZoomAnimation),d(a.worldCopyJump)&&(h.worldCopyJump=a.worldCopyJump),d(a.map)&&(h.map=a.map));var i=f(g,b);return g[i]=h,h}}}]),angular.module("leaflet-directive").factory("leafletEvents",["$rootScope","$q","$log","leafletHelpers",function(a,b,c,d){var e=d.safeApply,f=d.isDefined,g=d.isObject,h=d,i=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu"]},j=function(a,b,c,d){for(var e=i(),f="markers."+d,g=0;g<e.length;g++){var h=e[g];c.label.on(h,m(a,h,b,c.label,f))}},k=function(b,c,d,f,g,h){return function(i){var j="leafletDirectiveMarker."+b;"click"===b?e(d,function(){a.$broadcast("leafletDirectiveMarkersClick",g)}):"dragend"===b&&(e(d,function(){h.lat=f.getLatLng().lat,h.lng=f.getLatLng().lng}),h.message&&h.focus===!0&&f.openPopup()),e(d,function(b){"emit"===c?b.$emit(j,{markerName:g,leafletEvent:i}):a.$broadcast(j,{markerName:g,leafletEvent:i})})}},l=function(b,c,d,f,g){return function(f){var h="leafletDirectivePath."+b;e(d,function(b){"emit"===c?b.$emit(h,{pathName:g,leafletEvent:f}):a.$broadcast(h,{pathName:g,leafletEvent:f})})}},m=function(b,c,d,f,g){return function(h){var i="leafletDirectiveLabel."+c,j=g.replace("markers.","");e(b,function(b){"emit"===d?b.$emit(i,{leafletEvent:h,label:f,markerName:j}):"broadcast"===d&&a.$broadcast(i,{leafletEvent:h,label:f,markerName:j})})}},n=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose"]},o=function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","add","remove","popupopen","popupclose"]};return{getAvailableMapEvents:function(){return["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose","draw:created","draw:edited","draw:deleted","draw:drawstart","draw:drawstop","draw:editstart","draw:editstop","draw:deletestart","draw:deletestop"]},genDispatchMapEvent:function(b,c,d){return function(f){var g="leafletDirectiveMap."+c;e(b,function(b){"emit"===d?b.$emit(g,{leafletEvent:f}):"broadcast"===d&&a.$broadcast(g,{leafletEvent:f})})}},getAvailableMarkerEvents:n,getAvailablePathEvents:o,notifyCenterChangedToBounds:function(a){a.$broadcast("boundsChanged")},notifyCenterUrlHashChanged:function(a,b,c,d){if(f(c.urlHashCenter)){var e=b.getCenter(),g=e.lat.toFixed(4)+":"+e.lng.toFixed(4)+":"+b.getZoom();f(d.c)&&d.c===g||a.$emit("centerUrlHash",g)}},bindMarkerEvents:function(a,b,d,e){var i,l,m=[],o="broadcast";if(f(e.eventBroadcast))if(g(e.eventBroadcast))if(f(e.eventBroadcast.marker))if(g(e.eventBroadcast.marker)){void 0!==e.eventBroadcast.marker.logic&&null!==e.eventBroadcast.marker.logic&&("emit"!==e.eventBroadcast.marker.logic&&"broadcast"!==e.eventBroadcast.marker.logic?c.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===e.eventBroadcast.marker.logic&&(o="emit"));var p=!1,q=!1;if(void 0!==e.eventBroadcast.marker.enable&&null!==e.eventBroadcast.marker.enable&&"object"==typeof e.eventBroadcast.marker.enable&&(p=!0),void 0!==e.eventBroadcast.marker.disable&&null!==e.eventBroadcast.marker.disable&&"object"==typeof e.eventBroadcast.marker.disable&&(q=!0),p&&q)c.warn("[AngularJS - Leaflet] can not enable and disable events at the same time");else if(p||q)if(p)for(i=0;i<e.eventBroadcast.marker.enable.length;i++)l=e.eventBroadcast.marker.enable[i],-1!==m.indexOf(l)?c.warn("[AngularJS - Leaflet] This event "+l+" is already enabled"):-1===n().indexOf(l)?c.warn("[AngularJS - Leaflet] This event "+l+" does not exist"):m.push(l);else for(m=n(),i=0;i<e.eventBroadcast.marker.disable.length;i++){l=e.eventBroadcast.marker.disable[i];var r=m.indexOf(l);-1===r?c.warn("[AngularJS - Leaflet] This event "+l+" does not exist or has been already disabled"):m.splice(r,1)}else c.warn("[AngularJS - Leaflet] must enable or disable events")}else c.warn("[AngularJS - Leaflet] event-broadcast.marker must be an object check your model.");else m=n();else c.error("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else m=n();for(i=0;i<m.length;i++)l=m[i],a.on(l,k(l,o,e,a,b,d));h.LabelPlugin.isLoaded()&&f(a.label)&&j(e,o,a,b)},bindPathEvents:function(a,b,d,e){var i,k,m=[],n="broadcast";if(window.lls=e,f(e.eventBroadcast))if(g(e.eventBroadcast))if(f(e.eventBroadcast.path))if(g(e.eventBroadcast.paths))c.warn("[AngularJS - Leaflet] event-broadcast.path must be an object check your model.");else{void 0!==e.eventBroadcast.path.logic&&null!==e.eventBroadcast.path.logic&&("emit"!==e.eventBroadcast.path.logic&&"broadcast"!==e.eventBroadcast.path.logic?c.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===e.eventBroadcast.path.logic&&(n="emit"));var p=!1,q=!1;if(void 0!==e.eventBroadcast.path.enable&&null!==e.eventBroadcast.path.enable&&"object"==typeof e.eventBroadcast.path.enable&&(p=!0),void 0!==e.eventBroadcast.path.disable&&null!==e.eventBroadcast.path.disable&&"object"==typeof e.eventBroadcast.path.disable&&(q=!0),p&&q)c.warn("[AngularJS - Leaflet] can not enable and disable events at the same time");else if(p||q)if(p)for(i=0;i<e.eventBroadcast.path.enable.length;i++)k=e.eventBroadcast.path.enable[i],-1!==m.indexOf(k)?c.warn("[AngularJS - Leaflet] This event "+k+" is already enabled"):-1===o().indexOf(k)?c.warn("[AngularJS - Leaflet] This event "+k+" does not exist"):m.push(k);else for(m=o(),i=0;i<e.eventBroadcast.path.disable.length;i++){k=e.eventBroadcast.path.disable[i];var r=m.indexOf(k);-1===r?c.warn("[AngularJS - Leaflet] This event "+k+" does not exist or has been already disabled"):m.splice(r,1)}else c.warn("[AngularJS - Leaflet] must enable or disable events")}else m=o();else c.error("[AngularJS - Leaflet] event-broadcast must be an object check your model.");else m=o();for(i=0;i<m.length;i++)k=m[i],a.on(k,l(k,n,e,m,b));h.LabelPlugin.isLoaded()&&f(a.label)&&j(e,n,a,b)}}}]),angular.module("leaflet-directive").factory("leafletLayerHelpers",["$rootScope","$log","leafletHelpers",function($rootScope,$log,leafletHelpers){function isValidLayerType(a){return isString(a.type)?-1===Object.keys(layerTypes).indexOf(a.type)?($log.error("[AngularJS - Leaflet] A layer must have a valid type: "+Object.keys(layerTypes)),!1):layerTypes[a.type].mustHaveUrl&&!isString(a.url)?($log.error("[AngularJS - Leaflet] A base layer must have an url"),!1):layerTypes[a.type].mustHaveData&&!isDefined(a.data)?($log.error('[AngularJS - Leaflet] The base layer must have a "data" array attribute'),!1):layerTypes[a.type].mustHaveLayer&&!isDefined(a.layer)?($log.error("[AngularJS - Leaflet] The type of layer "+a.type+" must have an layer defined"),!1):layerTypes[a.type].mustHaveBounds&&!isDefined(a.bounds)?($log.error("[AngularJS - Leaflet] The type of layer "+a.type+" must have bounds defined"),!1):!0:!1}var Helpers=leafletHelpers,isString=leafletHelpers.isString,isObject=leafletHelpers.isObject,isDefined=leafletHelpers.isDefined,layerTypes={xyz:{mustHaveUrl:!0,createLayer:function(a){return L.tileLayer(a.url,a.options)}},geoJSON:{mustHaveUrl:!0,createLayer:function(a){return Helpers.GeoJSONPlugin.isLoaded()?new L.TileLayer.GeoJSON(a.url,a.pluginOptions,a.options):void 0}},wms:{mustHaveUrl:!0,createLayer:function(a){return L.tileLayer.wms(a.url,a.options)}},wmts:{mustHaveUrl:!0,createLayer:function(a){return L.tileLayer.wmts(a.url,a.options)}},wfs:{mustHaveUrl:!0,mustHaveLayer:!0,createLayer:function(params){if(Helpers.WFSLayerPlugin.isLoaded()){var options=angular.copy(params.options);return options.crs&&"string"==typeof options.crs&&(options.crs=eval(options.crs)),new L.GeoJSON.WFS(params.url,params.layer,options)}}},group:{mustHaveUrl:!1,createLayer:function(){return L.layerGroup()}},featureGroup:{mustHaveUrl:!1,createLayer:function(){return L.featureGroup()}},google:{mustHaveUrl:!1,createLayer:function(a){var b=a.type||"SATELLITE";if(Helpers.GoogleLayerPlugin.isLoaded())return new L.Google(b,a.options)}},china:{mustHaveUrl:!1,createLayer:function(a){var b=a.type||"";if(Helpers.ChinaLayerPlugin.isLoaded())return L.tileLayer.chinaProvider(b,a.options)}},ags:{mustHaveUrl:!0,createLayer:function(a){if(Helpers.AGSLayerPlugin.isLoaded()){var b=angular.copy(a.options);angular.extend(b,{url:a.url});var c=new lvector.AGS(b);return c.onAdd=function(a){this.setMap(a)},c.onRemove=function(){this.setMap(null)},c}}},dynamic:{mustHaveUrl:!0,createLayer:function(a){return Helpers.DynamicMapLayerPlugin.isLoaded()?L.esri.dynamicMapLayer(a.url,a.options):void 0}},markercluster:{mustHaveUrl:!1,createLayer:function(a){return Helpers.MarkerClusterPlugin.isLoaded()?new L.MarkerClusterGroup(a.options):void $log.error("[AngularJS - Leaflet] The markercluster plugin is not loaded.")}},bing:{mustHaveUrl:!1,createLayer:function(a){return Helpers.BingLayerPlugin.isLoaded()?new L.BingLayer(a.key,a.options):void 0}},heatmap:{mustHaveUrl:!1,mustHaveData:!0,createLayer:function(a){if(Helpers.HeatMapLayerPlugin.isLoaded()){var b=new L.TileLayer.WebGLHeatMap(a.options);return isDefined(a.data)&&b.setData(a.data),b}}},yandex:{mustHaveUrl:!1,createLayer:function(a){var b=a.type||"map";if(Helpers.YandexLayerPlugin.isLoaded())return new L.Yandex(b,a.options)}},imageOverlay:{mustHaveUrl:!0,mustHaveBounds:!0,createLayer:function(a){return L.imageOverlay(a.url,a.bounds,a.options)}}};return{createLayer:function(a){if(isValidLayerType(a)){if(!isString(a.name))return void $log.error("[AngularJS - Leaflet] A base layer must have a name");isObject(a.layerParams)||(a.layerParams={}),isObject(a.layerOptions)||(a.layerOptions={});for(var b in a.layerParams)a.layerOptions[b]=a.layerParams[b];var c={url:a.url,data:a.data,options:a.layerOptions,layer:a.layer,type:a.layerType,bounds:a.bounds,key:a.key,pluginOptions:a.pluginOptions};return layerTypes[a.type].createLayer(c)}}}}]),angular.module("leaflet-directive").factory("leafletControlHelpers",["$rootScope","$log","leafletHelpers","leafletMapDefaults",function(a,b,c,d){var e,f=c.isObject,g=c.isDefined,h=function(a,b){var c=0;return f(a)&&(c+=Object.keys(a).length),f(b)&&(c+=Object.keys(b).length),c>1},i=function(a){var b,c=d.getDefaults(a),e={collapsed:c.controls.layers.collapsed,position:c.controls.layers.position};return b=c.controls.layers&&g(c.controls.layers.control)?c.controls.layers.control.apply(this,[[],[],e]):new L.control.layers([],[],e)};return{layersControlMustBeVisible:h,updateLayersControl:function(a,b,c,d,f,j){var k,l=h(d,f);if(g(e)&&c){for(k in j.baselayers)e.removeLayer(j.baselayers[k]);for(k in j.overlays)e.removeLayer(j.overlays[k]);e.removeFrom(a)}if(l){e=i(b);for(k in d)g(j.baselayers[k])&&e.addBaseLayer(j.baselayers[k],d[k].name);for(k in f)g(j.overlays[k])&&e.addOverlay(j.overlays[k],f[k].name);e.addTo(a)}return l}}}]),angular.module("leaflet-directive").factory("leafletLegendHelpers",function(){var a=function(a,b){if(a.innerHTML="",b.error)a.innerHTML+='<div class="info-title alert alert-danger">'+b.error.message+"</div>";else for(var c=0;c<b.layers.length;c++){var d=b.layers[c];a.innerHTML+='<div class="info-title">'+d.layerName+"</div>";for(var e=0;e<d.legend.length;e++){var f=d.legend[e];a.innerHTML+='<div class="inline"><img src="data:'+f.contentType+";base64,"+f.imageData+'" /></div><div class="info-label">'+f.label+"</div>"}}},b=function(b,c){return function(){var d=L.DomUtil.create("div",c);return L.Browser.touch?L.DomEvent.on(d,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(d),L.DomEvent.on(d,"mousewheel",L.DomEvent.stopPropagation)),a(d,b),d}},c=function(a,b){return function(){for(var c=L.DomUtil.create("div",b),d=0;d<a.colors.length;d++)c.innerHTML+='<div class="outline"><i style="background:'+a.colors[d]+'"></i></div><div class="info-label">'+a.labels[d]+"</div>";return L.Browser.touch?L.DomEvent.on(c,"click",L.DomEvent.stopPropagation):(L.DomEvent.disableClickPropagation(c),L.DomEvent.on(c,"mousewheel",L.DomEvent.stopPropagation)),c}};return{getOnAddArcGISLegend:b,getOnAddArrayLegend:c,updateArcGISLegend:a}}),angular.module("leaflet-directive").factory("leafletPathsHelpers",["$rootScope","$log","leafletHelpers",function(a,b,c){function d(a){return a.filter(function(a){return k(a)}).map(function(a){return new L.LatLng(a.lat,a.lng)})}function e(a){return new L.LatLng(a.lat,a.lng)}function f(a){return a.map(function(a){return d(a)})}function g(a,b){for(var c={},d=0;d<l.length;d++){var e=l[d];h(a[e])?c[e]=a[e]:h(b.path[e])&&(c[e]=b.path[e])}return c}var h=c.isDefined,i=c.isArray,j=c.isNumber,k=c.isValidPoint,l=["stroke","weight","color","opacity","fill","fillColor","fillOpacity","dashArray","lineCap","lineJoin","clickable","pointerEvents","className","smoothFactor","noClip"],m=function(a,b){for(var c={},d=0;d<l.length;d++){var e=l[d];h(b[e])&&(c[e]=b[e])}a.setStyle(b)},n=function(a){if(!i(a))return!1;for(var b in a){var c=a[b];if(!k(c))return!1}return!0},o={polyline:{isValid:function(a){var b=a.latlngs;return n(b)},createPath:function(a){return new L.Polyline([],a)},setPath:function(a,b){a.setLatLngs(d(b.latlngs)),m(a,b)}},multiPolyline:{isValid:function(a){var b=a.latlngs;if(!i(b))return!1;for(var c in b){var d=b[c];if(!n(d))return!1}return!0},createPath:function(a){return new L.multiPolyline([[[0,0],[1,1]]],a)},setPath:function(a,b){a.setLatLngs(f(b.latlngs)),m(a,b)}},polygon:{isValid:function(a){var b=a.latlngs;return n(b)},createPath:function(a){return new L.Polygon([],a)},setPath:function(a,b){a.setLatLngs(d(b.latlngs)),m(a,b)}},multiPolygon:{isValid:function(a){var b=a.latlngs;if(!i(b))return!1;for(var c in b){var d=b[c];if(!n(d))return!1}return!0},createPath:function(a){return new L.MultiPolygon([[[0,0],[1,1],[0,1]]],a)},setPath:function(a,b){a.setLatLngs(f(b.latlngs)),m(a,b)}},rectangle:{isValid:function(a){var b=a.latlngs;if(!i(b)||2!==b.length)return!1;for(var c in b){var d=b[c];if(!k(d))return!1}return!0},createPath:function(a){return new L.Rectangle([[0,0],[1,1]],a)},setPath:function(a,b){a.setBounds(new L.LatLngBounds(d(b.latlngs))),m(a,b)}},circle:{isValid:function(a){var b=a.latlngs;return k(b)&&j(a.radius)},createPath:function(a){return new L.Circle([0,0],1,a)},setPath:function(a,b){a.setLatLng(e(b.latlngs)),h(b.radius)&&a.setRadius(b.radius),m(a,b)}},circleMarker:{isValid:function(a){var b=a.latlngs;return k(b)&&j(a.radius)},createPath:function(a){return new L.CircleMarker([0,0],a)},setPath:function(a,b){a.setLatLng(e(b.latlngs)),h(b.radius)&&a.setRadius(b.radius),m(a,b)}}},p=function(a){var b={};return a.latlngs&&(b.latlngs=a.latlngs),a.radius&&(b.radius=a.radius),b};return{setPathOptions:function(a,b,c){h(b)||(b="polyline"),o[b].setPath(a,c)},createPath:function(a,c,d){h(c.type)||(c.type="polyline");var e=g(c,d),f=p(c);return o[c.type].isValid(f)?o[c.type].createPath(e):void b.error("[AngularJS - Leaflet] Invalid data passed to the "+c.type+" path")}}}]),angular.module("leaflet-directive").factory("leafletBoundsHelpers",["$log","leafletHelpers",function(a,b){function c(a){return angular.isDefined(a)&&angular.isDefined(a.southWest)&&angular.isDefined(a.northEast)&&angular.isNumber(a.southWest.lat)&&angular.isNumber(a.southWest.lng)&&angular.isNumber(a.northEast.lat)&&angular.isNumber(a.northEast.lng)}var d=b.isArray,e=b.isNumber;return{createLeafletBounds:function(a){return c(a)?L.latLngBounds([a.southWest.lat,a.southWest.lng],[a.northEast.lat,a.northEast.lng]):void 0},isValidBounds:c,createBoundsFromArray:function(b){return d(b)&&2===b.length&&d(b[0])&&d(b[1])&&2===b[0].length&&2===b[1].length&&e(b[0][0])&&e(b[0][1])&&e(b[1][0])&&e(b[1][1])?{northEast:{lat:b[0][0],lng:b[0][1]},southWest:{lat:b[1][0],lng:b[1][1]}}:void a.error("[AngularJS - Leaflet] The bounds array is not valid.")}}}]),angular.module("leaflet-directive").factory("leafletMarkersHelpers",["$rootScope","leafletHelpers","$log",function(a,b,c){var d=b.isDefined,e=b.MarkerClusterPlugin,f=b.AwesomeMarkersPlugin,g=b.MakiMarkersPlugin,h=b.ExtraMarkersPlugin,i=b.safeApply,j=b,k=b.isString,l=b.isNumber,m=b.isObject,n={},o=function(a){if(d(a)&&d(a.type)&&"awesomeMarker"===a.type)return f.isLoaded()||c.error("[AngularJS - Leaflet] The AwesomeMarkers Plugin is not loaded."),new L.AwesomeMarkers.icon(a);if(d(a)&&d(a.type)&&"makiMarker"===a.type)return g.isLoaded()||c.error("[AngularJS - Leaflet] The MakiMarkers Plugin is not loaded."),new L.MakiMarkers.icon(a);if(d(a)&&d(a.type)&&"ExtraMarker"===a.type)return h.isLoaded()||c.error("[AngularJS - Leaflet] The ExtraMarkers Plugin is not loaded."),new L.ExtraMarkers.icon(a);if(d(a)&&d(a.type)&&"div"===a.type)return new L.divIcon(a);var b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAGmklEQVRYw7VXeUyTZxjvNnfELFuyIzOabermMZEeQC/OclkO49CpOHXOLJl/CAURuYbQi3KLgEhbrhZ1aDwmaoGqKII6odATmH/scDFbdC7LvFqOCc+e95s2VG50X/LLm/f4/Z7neY/ne18aANCmAr5E/xZf1uDOkTcGcWR6hl9247tT5U7Y6SNvWsKT63P58qbfeLJG8M5qcgTknrvvrdDbsT7Ml+tv82X6vVxJE33aRmgSyYtcWVMqX97Yv2JvW39UhRE2HuyBL+t+gK1116ly06EeWFNlAmHxlQE0OMiV6mQCScusKRlhS3QLeVJdl1+23h5dY4FNB3thrbYboqptEFlphTC1hSpJnbRvxP4NWgsE5Jyz86QNNi/5qSUTGuFk1gu54tN9wuK2wc3o+Wc13RCmsoBwEqzGcZsxsvCSy/9wJKf7UWf1mEY8JWfewc67UUoDbDjQC+FqK4QqLVMGGR9d2wurKzqBk3nqIT/9zLxRRjgZ9bqQgub+DdoeCC03Q8j+0QhFhBHR/eP3U/zCln7Uu+hihJ1+bBNffLIvmkyP0gpBZWYXhKussK6mBz5HT6M1Nqpcp+mBCPXosYQfrekGvrjewd59/GvKCE7TbK/04/ZV5QZYVWmDwH1mF3xa2Q3ra3DBC5vBT1oP7PTj4C0+CcL8c7C2CtejqhuCnuIQHaKHzvcRfZpnylFfXsYJx3pNLwhKzRAwAhEqG0SpusBHfAKkxw3w4627MPhoCH798z7s0ZnBJ/MEJbZSbXPhER2ih7p2ok/zSj2cEJDd4CAe+5WYnBCgR2uruyEw6zRoW6/DWJ/OeAP8pd/BGtzOZKpG8oke0SX6GMmRk6GFlyAc59K32OTEinILRJRchah8HQwND8N435Z9Z0FY1EqtxUg+0SO6RJ/mmXz4VuS+DpxXC3gXmZwIL7dBSH4zKE50wESf8qwVgrP1EIlTO5JP9Igu0aexdh28F1lmAEGJGfh7jE6ElyM5Rw/FDcYJjWhbeiBYoYNIpc2FT/SILivp0F1ipDWk4BIEo2VuodEJUifhbiltnNBIXPUFCMpthtAyqws/BPlEF/VbaIxErdxPphsU7rcCp8DohC+GvBIPJS/tW2jtvTmmAeuNO8BNOYQeG8G/2OzCJ3q+soYB5i6NhMaKr17FSal7GIHheuV3uSCY8qYVuEm1cOzqdWr7ku/R0BDoTT+DT+ohCM6/CCvKLKO4RI+dXPeAuaMqksaKrZ7L3FE5FIFbkIceeOZ2OcHO6wIhTkNo0ffgjRGxEqogXHYUPHfWAC/lADpwGcLRY3aeK4/oRGCKYcZXPVoeX/kelVYY8dUGf8V5EBRbgJXT5QIPhP9ePJi428JKOiEYhYXFBqou2Guh+p/mEB1/RfMw6rY7cxcjTrneI1FrDyuzUSRm9miwEJx8E/gUmqlyvHGkneiwErR21F3tNOK5Tf0yXaT+O7DgCvALTUBXdM4YhC/IawPU+2PduqMvuaR6eoxSwUk75ggqsYJ7VicsnwGIkZBSXKOUww73WGXyqP+J2/b9c+gi1YAg/xpwck3gJuucNrh5JvDPvQr0WFXf0piyt8f8/WI0hV4pRxxkQZdJDfDJNOAmM0Ag8jyT6hz0WGXWuP94Yh2jcfjmXAGvHCMslRimDHYuHuDsy2QtHuIavznhbYURq5R57KpzBBRZKPJi8eQg48h4j8SDdowifdIrEVdU+gbO6QNvRRt4ZBthUaZhUnjlYObNagV3keoeru3rU7rcuceqU1mJBxy+BWZYlNEBH+0eH4vRiB+OYybU2hnblYlTvkHinM4m54YnxSyaZYSF6R3jwgP7udKLGIX6r/lbNa9N6y5MFynjWDtrHd75ZvTYAPO/6RgF0k76mQla3FGq7dO+cH8sKn0Vo7nDllwAhqwLPkxrHwWmHJOo+AKJ4rab5OgrM7rVu8eWb2Pu0Dh4eDgXoOfvp7Y7QeqknRmvcTBEyq9m/HQQSCSz6LHq3z0yzsNySRfMS253wl2KyRDbcZPcfJKjZmSEOjcxyi+Y8dUOtsIEH6R2wNykdqrkYJ0RV92H0W58pkfQk7cKevsLK10Py8SdMGfXNXATY+pPbyJR/ET6n9nIfztNtZYRV9XniQu9IA2vOVgy4ir7GCLVmmd+zjkH0eAF9Po6K61pmCXHxU5rHMYd1ftc3owjwRSVRzLjKvqZEty6cRUD7jGqiOdu5HG6MdHjNcNYGqfDm5YRzLBBCCDl/2bk8a8gdbqcfwECu62Fg/HrggAAAABJRU5ErkJggg==",e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAYAAACoYAD2AAAC5ElEQVRYw+2YW4/TMBCF45S0S1luXZCABy5CgLQgwf//S4BYBLTdJLax0fFqmB07nnQfEGqkIydpVH85M+NLjPe++dcPc4Q8Qh4hj5D/AaQJx6H/4TMwB0PeBNwU7EGQAmAtsNfAzoZkgIa0ZgLMa4Aj6CxIAsjhjOCoL5z7Glg1JAOkaicgvQBXuncwJAWjksLtBTWZe04CnYRktUGdilALppZBOgHGZcBzL6OClABvMSVIzyBjazOgrvACf1ydC5mguqAVg6RhdkSWQFj2uxfaq/BrIZOLEWgZdALIDvcMcZLD8ZbLC9de4yR1sYMi4G20S4Q/PWeJYxTOZn5zJXANZHIxAd4JWhPIloTJZhzMQduM89WQ3MUVAE/RnhAXpTycqys3NZALOBbB7kFrgLesQl2h45Fcj8L1tTSohUwuxhy8H/Qg6K7gIs+3kkaigQCOcyEXCHN07wyQazhrmIulvKMQAwMcmLNqyCVyMAI+BuxSMeTk3OPikLY2J1uE+VHQk6ANrhds+tNARqBeaGc72cK550FP4WhXmFmcMGhTwAR1ifOe3EvPqIegFmF+C8gVy0OfAaWQPMR7gF1OQKqGoBjq90HPMP01BUjPOqGFksC4emE48tWQAH0YmvOgF3DST6xieJgHAWxPAHMuNhrImIdvoNOKNWIOcE+UXE0pYAnkX6uhWsgVXDxHdTfCmrEEmMB2zMFimLVOtiiajxiGWrbU52EeCdyOwPEQD8LqyPH9Ti2kgYMf4OhSKB7qYILbBv3CuVTJ11Y80oaseiMWOONc/Y7kJYe0xL2f0BaiFTxknHO5HaMGMublKwxFGzYdWsBF174H/QDknhTHmHHN39iWFnkZx8lPyM8WHfYELmlLKtgWNmFNzQcC1b47gJ4hL19i7o65dhH0Negbca8vONZoP7doIeOC9zXm8RjuL0Gf4d4OYaU5ljo3GYiqzrWQHfJxA6ALhDpVKv9qYeZA8eM3EhfPSCmpuD0AAAAASUVORK5CYII=";return d(a)?(d(a.iconUrl)||(a.iconUrl=b,a.shadowUrl=e),new L.Icon.Default(a)):new L.Icon.Default({iconUrl:b,shadowUrl:e})},p=function(a,b,c){if(a.closePopup(),d(c)&&d(c.overlays))for(var e in c.overlays)if((c.overlays[e]instanceof L.LayerGroup||c.overlays[e]instanceof L.FeatureGroup)&&c.overlays[e].hasLayer(a))return void c.overlays[e].removeLayer(a);if(d(n))for(var f in n)n[f].hasLayer(a)&&n[f].removeLayer(a);b.hasLayer(a)&&b.removeLayer(a)};return{deleteMarker:p,createMarker:function(a){if(!d(a))return void c.error("[AngularJS - Leaflet] The marker definition is not valid.");var b={icon:o(a.icon),title:d(a.title)?a.title:"",draggable:d(a.draggable)?a.draggable:!1,clickable:d(a.clickable)?a.clickable:!0,riseOnHover:d(a.riseOnHover)?a.riseOnHover:!1,zIndexOffset:d(a.zIndexOffset)?a.zIndexOffset:0,iconAngle:d(a.iconAngle)?a.iconAngle:0};for(var e in a)a.hasOwnProperty(e)&&!b.hasOwnProperty(e)&&(b[e]=a[e]);return new L.marker(a,b)},addMarkerToGroup:function(a,b,f){return k(b)?e.isLoaded()?(d(n[b])||(n[b]=new L.MarkerClusterGroup,f.addLayer(n[b])),void n[b].addLayer(a)):void c.error("[AngularJS - Leaflet] The MarkerCluster plugin is not loaded."):void c.error("[AngularJS - Leaflet] The marker group you have specified is invalid.")},listenMarkerEvents:function(a,b,c){a.on("popupopen",function(){i(c,function(){b.focus=!0})}),a.on("popupclose",function(){i(c,function(){b.focus=!1})})},addMarkerWatcher:function(a,b,e,f,g){var h=e.$watch("markers."+b,function(b,e){if(!d(b))return p(a,g,f),void h();if(d(e)){if(!l(b.lat)||!l(b.lng))return c.warn("There are problems with lat-lng data, please verify your marker model"),void p(a,g,f);if(k(b.layer)||k(e.layer)&&(d(f.overlays[e.layer])&&f.overlays[e.layer].hasLayer(a)&&(f.overlays[e.layer].removeLayer(a),a.closePopup()),g.hasLayer(a)||g.addLayer(a)),k(b.layer)&&e.layer!==b.layer){if(k(e.layer)&&d(f.overlays[e.layer])&&f.overlays[e.layer].hasLayer(a)&&f.overlays[e.layer].removeLayer(a),a.closePopup(),g.hasLayer(a)&&g.removeLayer(a),!d(f.overlays[b.layer]))return void c.error("[AngularJS - Leaflet] You must use a name of an existing layer");var i=f.overlays[b.layer];if(!(i instanceof L.LayerGroup||i instanceof L.FeatureGroup))return void c.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group" or "featureGroup"');i.addLayer(a),g.hasLayer(a)&&b.focus===!0&&a.openPopup()}if(b.draggable!==!0&&e.draggable===!0&&d(a.dragging)&&a.dragging.disable(),b.draggable===!0&&e.draggable!==!0&&(a.dragging?a.dragging.enable():L.Handler.MarkerDrag&&(a.dragging=new L.Handler.MarkerDrag(a),a.options.draggable=!0,a.dragging.enable())),m(b.icon)||m(e.icon)&&(a.setIcon(o()),a.closePopup(),a.unbindPopup(),k(b.message)&&a.bindPopup(b.message)),m(b.icon)&&m(e.icon)&&!angular.equals(b.icon,e.icon)){var n=!1;a.dragging&&(n=a.dragging.enabled()),a.setIcon(o(b.icon)),n&&a.dragging.enable(),a.closePopup(),a.unbindPopup(),k(b.message)&&a.bindPopup(b.message)}!k(b.message)&&k(e.message)&&(a.closePopup(),a.unbindPopup()),j.LabelPlugin.isLoaded()&&d(b.label)&&d(b.label.message)&&!angular.equals(b.label.message,e.label.message)&&a.updateLabelContent(b.label.message),k(b.message)&&!k(e.message)&&(a.bindPopup(b.message),b.focus===!0&&a.openPopup()),k(b.message)&&k(e.message)&&b.message!==e.message&&a.setPopupContent(b.message);var q=!1;b.focus!==!0&&e.focus===!0&&(a.closePopup(),q=!0),b.focus===!0&&e.focus!==!0&&(a.openPopup(),q=!0),e.focus===!0&&b.focus===!0&&(a.openPopup(),q=!0);var r=a.getLatLng(),s=k(b.layer)&&j.MarkerClusterPlugin.is(f.overlays[b.layer]);
s?q?(b.lat!==e.lat||b.lng!==e.lng)&&(f.overlays[b.layer].removeLayer(a),a.setLatLng([b.lat,b.lng]),f.overlays[b.layer].addLayer(a)):r.lat!==b.lat||r.lng!==b.lng?(f.overlays[b.layer].removeLayer(a),a.setLatLng([b.lat,b.lng]),f.overlays[b.layer].addLayer(a)):(b.lat!==e.lat||b.lng!==e.lng)&&(f.overlays[b.layer].removeLayer(a),a.setLatLng([b.lat,b.lng]),f.overlays[b.layer].addLayer(a)):(r.lat!==b.lat||r.lng!==b.lng)&&a.setLatLng([b.lat,b.lng])}},!0)}}}]),angular.module("leaflet-directive").factory("leafletHelpers",["$q","$log",function(a,b){function c(a,c){var d,e;if(angular.isDefined(c))d=c;else if(1===Object.keys(a).length)for(e in a)a.hasOwnProperty(e)&&(d=e);else 0===Object.keys(a).length?d="main":b.error("[AngularJS - Leaflet] - You have more than 1 map on the DOM, you must provide the map ID to the leafletData.getXXX call");return d}function d(b,d){var e,f=c(b,d);return angular.isDefined(b[f])&&b[f].resolvedDefer!==!0?e=b[f].defer:(e=a.defer(),b[f]={defer:e,resolvedDefer:!1}),e}return{isEmpty:function(a){return 0===Object.keys(a).length},isUndefinedOrEmpty:function(a){return angular.isUndefined(a)||null===a||0===Object.keys(a).length},isDefined:function(a){return angular.isDefined(a)&&null!==a},isNumber:function(a){return angular.isNumber(a)},isString:function(a){return angular.isString(a)},isArray:function(a){return angular.isArray(a)},isObject:function(a){return angular.isObject(a)},isFunction:function(a){return angular.isFunction(a)},equals:function(a,b){return angular.equals(a,b)},isValidCenter:function(a){return angular.isDefined(a)&&angular.isNumber(a.lat)&&angular.isNumber(a.lng)&&angular.isNumber(a.zoom)},isValidPoint:function(a){return angular.isDefined(a)&&angular.isNumber(a.lat)&&angular.isNumber(a.lng)},isSameCenterOnMap:function(a,b){var c=b.getCenter(),d=b.getZoom();return c.lat===a.lat&&c.lng===a.lng&&d===a.zoom?!0:!1},safeApply:function(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?a.$eval(b):a.$apply(b)},obtainEffectiveMapId:c,getDefer:function(a,b){var e,f=c(a,b);return e=angular.isDefined(a[f])&&a[f].resolvedDefer!==!1?a[f].defer:d(a,b)},getUnresolvedDefer:d,setResolvedDefer:function(a,b){var d=c(a,b);a[d].resolvedDefer=!0},AwesomeMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.AwesomeMarkers)&&angular.isDefined(L.AwesomeMarkers.Icon)?!0:!1},is:function(a){return this.isLoaded()?a instanceof L.AwesomeMarkers.Icon:!1},equal:function(a,b){return this.isLoaded()&&this.is(a)?angular.equals(a,b):!1}},PolylineDecoratorPlugin:{isLoaded:function(){return angular.isDefined(L.PolylineDecorator)?!0:!1},is:function(a){return this.isLoaded()?a instanceof L.PolylineDecorator:!1},equal:function(a,b){return this.isLoaded()&&this.is(a)?angular.equals(a,b):!1}},MakiMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.MakiMarkers)&&angular.isDefined(L.MakiMarkers.Icon)?!0:!1},is:function(a){return this.isLoaded()?a instanceof L.MakiMarkers.Icon:!1},equal:function(a,b){return this.isLoaded()&&this.is(a)?angular.equals(a,b):!1}},ExtraMarkersPlugin:{isLoaded:function(){return angular.isDefined(L.ExtraMarkers)&&angular.isDefined(L.ExtraMarkers.Icon)?!0:!1},is:function(a){return this.isLoaded()?a instanceof L.ExtraMarkers.Icon:!1},equal:function(a,b){return this.isLoaded()&&this.is(a)?angular.equals(a,b):!1}},LabelPlugin:{isLoaded:function(){return angular.isDefined(L.Label)},is:function(a){return this.isLoaded()?a instanceof L.MarkerClusterGroup:!1}},MarkerClusterPlugin:{isLoaded:function(){return angular.isDefined(L.MarkerClusterGroup)},is:function(a){return this.isLoaded()?a instanceof L.MarkerClusterGroup:!1}},GoogleLayerPlugin:{isLoaded:function(){return angular.isDefined(L.Google)},is:function(a){return this.isLoaded()?a instanceof L.Google:!1}},ChinaLayerPlugin:{isLoaded:function(){return angular.isDefined(L.tileLayer.chinaProvider)}},HeatMapLayerPlugin:{isLoaded:function(){return angular.isDefined(L.TileLayer.WebGLHeatMap)}},BingLayerPlugin:{isLoaded:function(){return angular.isDefined(L.BingLayer)},is:function(a){return this.isLoaded()?a instanceof L.BingLayer:!1}},WFSLayerPlugin:{isLoaded:function(){return void 0!==L.GeoJSON.WFS},is:function(a){return this.isLoaded()?a instanceof L.GeoJSON.WFS:!1}},AGSLayerPlugin:{isLoaded:function(){return void 0!==lvector&&void 0!==lvector.AGS},is:function(a){return this.isLoaded()?a instanceof lvector.AGS:!1}},YandexLayerPlugin:{isLoaded:function(){return angular.isDefined(L.Yandex)},is:function(a){return this.isLoaded()?a instanceof L.Yandex:!1}},DynamicMapLayerPlugin:{isLoaded:function(){return void 0!==L.esri&&void 0!==L.esri.dynamicMapLayer},is:function(a){return this.isLoaded()?a instanceof L.esri.dynamicMapLayer:!1}},GeoJSONPlugin:{isLoaded:function(){return angular.isDefined(L.TileLayer.GeoJSON)},is:function(a){return this.isLoaded()?a instanceof L.TileLayer.GeoJSON:!1}},Leaflet:{DivIcon:{is:function(a){return a instanceof L.DivIcon},equal:function(a,b){return this.is(a)?angular.equals(a,b):!1}},Icon:{is:function(a){return a instanceof L.Icon},equal:function(a,b){return this.is(a)?angular.equals(a,b):!1}}}}}])}();var app=angular.module("IF",["ngRoute","tidepoolsFilters","tidepoolsServices","ngSanitize","leaflet-directive","angularFileUpload","IF-directives","ngAnimate","mgcrea.ngStrap","once","angularSpectrumColorpicker","ui.slider"]).config(function(a,b,c,d,e){var f=(d.classNameFilter(/if-animate/i),function(a,b,c,d,e){var f=a.defer();return c.get("/api/user/loggedin").success(function(a){"0"!==a?(e.userName=a.facebook?a.facebook.name:a.twitter?a.twitter.displayName:a.local?a.local.email:"Me",e.showLogout=!0,b(f.resolve,0)):(e.showLogout=!1,e.message="You need to log in.",b(function(){f.reject()},0),d.url("/login"))}),f.promise});c.responseInterceptors.push(function(a,b){return function(c){return c.then(function(a){return a},function(c){return 401===c.status&&b.url("/login"),a.reject(c)})}}),a.when("/",{templateUrl:"components/nearby/nearby.html",controller:WorldRouteCtrl}).when("/nearby",{templateUrl:"components/nearby/nearby.html",controller:WorldRouteCtrl}).when("/login",{templateUrl:"components/auth/login.html",controller:LoginCtrl}).when("/forgot",{templateUrl:"components/auth/forgot.html",controller:ForgotCtrl}).when("/reset/:token",{templateUrl:"components/auth/change-password.html",controller:ResetCtrl}).when("/signup",{templateUrl:"components/auth/signup.html",controller:SignupCtrl}).when("/profile",{templateUrl:"components/auth/profile.html",controller:ProfileCtrl,resolve:{loggedin:f}}).when("/w/:worldURL",{templateUrl:"components/world/world.html",controller:WorldController}).when("/w/:worldURL/upcoming",{templateUrl:"components/world/upcoming.html",controller:WorldController}).when("/w/:worldURL/:landmarkURL",{templateUrl:"components/world/landmark.html",controller:LandmarkController}).when("/w/:worldURL/category/:category",{templateUrl:"components/world/category.html",controller:CategoryController}).when("/list/:category/:filter",{templateUrl:"partials/list.html",controller:ListCtrl}).when("/newpost",{templateUrl:"partials/landmark-new.html"}).when("/newpost/:type",{templateUrl:"partials/landmark-new-type.html",controller:LandmarkNewCtrl,resolve:{loggedin:f}}).when("/newworld",{templateUrl:"components/editor/world-maker.html",controller:WorldMakerCtrl,resolve:{loggedin:f}}).when("/newworld/:projectID",{templateUrl:"components/editor/world-maker.html",controller:WorldMakerCtrl,resolve:{loggedin:f}}).when("/edit/w/:worldURL/landmarks",{templateUrl:"components/editor/landmark-editor.html",controller:LandmarkEditorController,resolve:{loggedin:f}}).when("/edit/w/:worldURL/",{templateUrl:"components/edit/edit_world.html",controller:EditController,resolve:{loggedin:f}}).when("/edit/w/:worldURL/:view",{templateUrl:"components/edit/edit_world.html",controller:EditController,resolve:{loggedin:f}}).when("/edit/walkthrough/:_id/",{templateUrl:"components/edit/walkthrough/walkthrough.html",controller:WalkthroughController,rsolve:{loggedin:f}}).when("/search/:searchQuery",{templateUrl:"components/search/search.html",controller:SearchController}).when("/twitter/:hashTag",{templateUrl:"partials/tweet-list.html",controller:TweetlistCtrl}).when("/instagram/:hashTag",{templateUrl:"partials/insta-list.html",controller:InstalistCtrl}).when("/chat/:worldID",{templateUrl:"partials/chat.html",controller:ChatCtrl}).otherwise({redirectTo:"/"}),angular.extend(e.defaults,{animation:"am-fade",placement:"right",delay:{show:"0",hide:"250"}})}).run(function(a,b,c){a.message="",a.logout=function(){a.message="Logged out.",b.get("/api/user/logout"),a.showLogout=!1,c.url("/")}});angular.module("IF-directives",[]).directive("myPostRepeatDirective",function(){return function(a){if(a.$last){var b=$("#card-container");b.isotope({itemSelector:".iso-card"})}}}).directive("ngEnter",function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}),app.directive("ryFocus",function(){return{restrict:"A",scope:{shouldFocus:"=ryFocus"},link:function(a,b){a.$watch("shouldFocus",function(a,c){1!=a||c?0==a&&c&&b[0].blur():b[0].focus()})}}}),angular.module("tidepoolsFilters",[]).filter("hashtag",function(){return function(a){return a.replace(/[#]+[A-Za-z0-9-_]+/g,function(a){var b=a.replace("#","");return a.link("#/talk/"+b)})}}).filter("youtubestrip",function(){return function(a){if(a){var b=a.replace(/^[^_]*=/,"");return b}}}).filter("url",function(){return function(a){var b=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;return a.replace(b,function(a){return'<a href="'+a+'">'+a+"</a>"})}}).filter("unsafe",function(a){return function(b){return a.trustAsHtml(b)}}).filter("httpsify",function(){return function(a){return a.replace(/^http:\/\//i,"https://")}}).filter("userName",function(){return function(a){var b;return"string"==typeof a?(b=a.indexOf("@"),-1!=b?a.substr(0,b):a):a}});var userLat,userLon,global_mapCenter,local_icons={defaultIcon:{},yellowIcon:{iconUrl:"img/marker-icon.png",shadowUrl:"img/marker-shadow.png",iconSize:[25,41],shadowSize:[41,41],iconAnchor:[12,40],shadowAnchor:[12,40],popupAnchor:[0,-40]},leafIcon:{iconUrl:"img/leaf-green.png",shadowUrl:"img/leaf-shadow.png",iconSize:[38,95],shadowSize:[50,64],iconAnchor:[22,94],shadowAnchor:[4,62],popupAnchor:[-3,-76]},orangeLeafIcon:{iconUrl:"img/leaf-orange.png",shadowUrl:"img/leaf-shadow.png",iconSize:[38,95],shadowSize:[50,64],iconAnchor:[22,94],shadowAnchor:[4,62],popupAnchor:[-3,-76]},divIcon:{type:"div",iconSize:[200,0],popupAnchor:[0,0],html:"Using <strong>Bold text as an icon</strong>:"}},tilesDict={openstreetmap:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}},mapbox:{url:"https://{s}.tiles.mapbox.com/v3/interfacefoundry.ig1oichl/{z}/{x}/{y}.png",options:{attribution:"IF",minZoom:1,maxZoom:23,reuseTiles:!0}},aicp:{url:"1.0.0/aicpweek/{z}/{x}/{y}.png",options:{minZoom:16,maxZoom:23,reuseTiles:!0}},urban:{url:"https://{s}.tiles.mapbox.com/v3/interfacefoundry.ig6a7dkn/{z}/{x}/{y}.png",option:{attribution:"IF",minZoom:1,maxZoom:19,reuseTiles:!0}},fairy:{url:"https://{s}.tiles.mapbox.com/v3/interfacefoundry.ig9jd86b/{z}/{x}/{y}.png",option:{attribution:"IF",minZoom:1,maxZoom:23,reuseTiles:!0}},sunset:{url:"https://{s}.tiles.mapbox.com/v3/interfacefoundry.ig6f6j6e/{z}/{x}/{y}.png",option:{attribution:"IF",minZoom:1,maxZoom:23,reuseTiles:!0}},arabesque:{url:"https://{s}.tiles.mapbox.com/v3/interfacefoundry.ig67e7eb/{z}/{x}/{y}.png",option:{attribution:"IF",minZoom:1,maxZoom:23,reuseTiles:!0}}},mapSelect="cloud",global_hashtag="#HappyHourShowcase",eventCategories=["lecture","show","award"],placeCategories=["food","bars","sponsors","washrooms","exhibits","smoking"],globalEditLoc={};"undefined"!=typeof module&&"undefined"!=typeof module.exports&&(module.exports.hashtag=global_hashtag);var mainWindow,he;L.AreaSelect=L.Class.extend({includes:L.Mixin.Events,options:{width:200,height:300,keepAspectRatio:!1},initialize:function(a){L.Util.setOptions(this,a),this.options.width>1e3||this.options.height>1e3?(this._width=this.options.width/8,this._height=this.options.height/8):(this._width=this.options.width,this._height=this.options.height)},addTo:function(a){return this.map=a,this._createElements(),this._render(),this},getBounds:function(){var a=this.map.getSize(),b=new L.Point,c=new L.Point;c.x=Math.round((a.x-this._width)/2),b.y=Math.round((a.y-this._height)/2),b.x=a.x-c.x,c.y=a.y-b.y;var d=this.map.containerPointToLatLng(c),e=this.map.containerPointToLatLng(b);return new L.LatLngBounds(d,e)},remove:function(){this.map.off("moveend",this._onMapChange),this.map.off("zoomend",this._onMapChange),this.map.off("resize",this._onMapResize),this._container.remove()},_createElements:function(){this._container||(this._container=L.DomUtil.create("div","leaflet-areaselect-container",this.map._controlContainer),this._topShade=L.DomUtil.create("div","leaflet-areaselect-shade",this._container),this._bottomShade=L.DomUtil.create("div","leaflet-areaselect-shade",this._container),this._leftShade=L.DomUtil.create("div","leaflet-areaselect-shade",this._container),this._rightShade=L.DomUtil.create("div","leaflet-areaselect-shade",this._container),this._nwHandle=L.DomUtil.create("div","leaflet-areaselect-handle",this._container),this._swHandle=L.DomUtil.create("div","leaflet-areaselect-handle",this._container),this._neHandle=L.DomUtil.create("div","leaflet-areaselect-handle",this._container),this._seHandle=L.DomUtil.create("div","leaflet-areaselect-handle",this._container),this._setUpHandlerEvents(this._nwHandle),this._setUpHandlerEvents(this._neHandle,-1,1),this._setUpHandlerEvents(this._swHandle,1,-1),this._setUpHandlerEvents(this._seHandle,-1,-1),this.map.on("moveend",this._onMapChange,this),this.map.on("zoomend",this._onMapChange,this),this.map.on("resize",this._onMapResize,this),this.fire("change"))},_setUpHandlerEvents:function(a,b,c){function d(f){function g(a){if(e.options.keepAspectRatio){var d=(e._height>=e._width?l.y:l.y*(1/k))-30;e._height+=2*(j-a.originalEvent.y)*c,e._height=Math.max(30,e._height),e._height=Math.min(d,e._height),e._width=e._height*k}else e._width+=2*(i-a.originalEvent.x)*b,e._height+=2*(j-a.originalEvent.y)*c,e._width=Math.max(30,e._width),e._height=Math.max(30,e._height),e._width=Math.min(l.x-30,e._width),e._height=Math.min(l.y-30,e._height);i=a.originalEvent.x,j=a.originalEvent.y,e._render()}function h(){L.DomEvent.removeListener(e.map,"mouseup",h),L.DomEvent.removeListener(e.map,"mousemove",g),L.DomEvent.addListener(a,"mousedown",d),e.fire("change")}f.stopPropagation(),L.DomEvent.removeListener(this,"mousedown",d);var i=f.x,j=f.y,k=e._width/e._height,l=e.map.getSize();L.DomEvent.addListener(e.map,"mousemove",g),L.DomEvent.addListener(e.map,"mouseup",h)}b=b||1,c=c||1;var e=this;L.DomEvent.addListener(a,"mousedown",d)},_onMapResize:function(){this._render()},_onMapChange:function(){this.fire("change")},_render:function(){function a(a,b){a.style.width=b.width+"px",a.style.height=b.height+"px",a.style.top=b.top+"px",a.style.left=b.left+"px",a.style.bottom=b.bottom+"px",a.style.right=b.right+"px"}var b=this.map.getSize(),c=Math.round(this._nwHandle.offsetWidth/2),d=Math.round((b.y-this._height)/2),e=Math.round((b.x-this._width)/2);a(this._topShade,{width:b.x,height:d,top:0,left:0}),a(this._bottomShade,{width:b.x,height:d,bottom:0,left:0}),a(this._leftShade,{width:e,height:b.y-2*d,top:d,left:0}),a(this._rightShade,{width:e,height:b.y-2*d,top:d,right:0}),a(this._nwHandle,{left:e-c,top:d-7}),a(this._neHandle,{right:e-c,top:d-7}),a(this._swHandle,{left:e-c,bottom:d-7}),a(this._seHandle,{right:e-c,bottom:d-7})}}),L.areaSelect=function(a){return new L.AreaSelect(a)};var res;angular.module("tidepoolsServices",["ngResource"]).factory("Landmark",["$resource","$http",function(a){var b={count:{method:"PUT",params:{_id:"count"}},distinct:{method:"PUT",params:{_id:"distinct"}},find:{method:"PUT",params:{_id:"find"},isArray:!0},group:{method:"PUT",params:{_id:"group"},isArray:!0},mapReduce:{method:"PUT",params:{_id:"mapReduce"},isArray:!0},aggregate:{method:"PUT",params:{_id:"aggregate"},isArray:!0},del:{method:"DELETE",params:{_id:"del"},isArray:!1}};return res=a("/api/landmarks/:_id:id",{},b)}]).factory("World",["$resource","$http","leafletData",function(a){var b={count:{method:"PUT",params:{_id:"count"}},distinct:{method:"PUT",params:{_id:"distinct"}},find:{method:"PUT",params:{_id:"find"},isArray:!0},group:{method:"PUT",params:{_id:"group"},isArray:!0},mapReduce:{method:"PUT",params:{_id:"mapReduce"},isArray:!0},aggregate:{method:"PUT",params:{_id:"aggregate"},isArray:!0},del:{method:"DELETE",params:{_id:"del"},isArray:!0}};return res=a("/api/worlds/:_id:id",{},b)}]).factory("db",["$resource","$http",function(a){var b={count:{method:"PUT",params:{_id:"count"}},distinct:{method:"PUT",params:{_id:"distinct"}},find:{method:"PUT",params:{_id:"find"},isArray:!0},group:{method:"PUT",params:{_id:"group"},isArray:!0},mapReduce:{method:"PUT",params:{_id:"mapReduce"},isArray:!0},aggregate:{method:"PUT",params:{_id:"aggregate"},isArray:!0},create:{method:"POST",params:{_id:"create"},isArray:!0},locsearch:{method:"GET",params:{_id:"locsearch"},isArray:!0}},c={};return c.worlds=a("/api/worlds/:_id",{},b),c.landmarks=a("api/landmarks/:_id:id",{},b),c.styles=a("api/styles/:_id",{},b),c.projects=a("api/projects/:_id",{},b),c.tweets=a("api/tweets/:_id",{},b),c.instagrams=a("api/instagrams/:_id",{},b),c}]).factory("apertureService",["leafletData",function(){var a={};return a.off=!0,a.state="aperture-off",a.navfix="navfix",a.toggle=function(b){a.off?(a.off=!1,a.navfix="","half"==b&&(a.state="aperture-half"),"full"==b&&(a.state="aperture-full")):(a.off=!0,a.state="aperture-off",a.navfix="navfix")},a.set=function(b){switch(b){case"off":a.off=!0,a.state="aperture-off",a.navfix="navfix";break;case"half":a.off=!1,a.state="aperture-half",a.navfix="";break;case"full":a.off=!1,a.state="aperture-full",a.navfix=""}},a}]).factory("alertManager",["$timeout",function(a){var b={list:[]};return b.addAlert=function(c,d,e){b.list=[];var f;switch(c){case"success":f="alert-success";break;case"info":f="alert-info";break;case"warning":f="alert-warning";break;case"danger":f="alert-danger"}var g=b.list.push({"class":f,msg:d});e&&a(function(){b.list.splice(g-1,1)},3e3)},b.closeAlert=function(a){b.list.splice(a,1)},b}]).factory("socket",function(a){var b=io.connect();return{on:function(c,d){b.on(c,function(){var c=arguments;a.$apply(function(){d.apply(b,c)})})},emit:function(c,d,e){b.emit(c,d,function(){var c=arguments;a.$apply(function(){e&&e.apply(b,c)})})}}}),angular.module("tidepoolsServices").factory("mapManager",["leafletData","apertureService","$rootScope",function(a,b,c){function d(){a.getMap().then(function(a){setTimeout(function(){a.invalidateSize()},400)})}var e={center:{lat:42,lng:-83,zoom:14},markers:{},layers:{baselayers:{baseMap:{name:"Sunset",url:"https://{s}.tiles.mapbox.com/v3/interfacefoundry.ig6f6j6e/{z}/{x}/{y}.png",type:"xyz",top:!0}},overlays:{}},paths:{},maxbounds:{},defaults:{controls:{layers:{visible:!1,position:"bottomright",collapsed:!0}},zoomControlPosition:"bottomleft"}};return e.setCenter=function(c,d){if("aperture-half"==b.state){var f,g,h=Math.max(document.documentElement.clientHeight,window.innerHeight||0);a.getMap().then(function(a){f=a.project([c[1],c[0]],d).add([0,h/2]),g=a.unproject(f,d),angular.extend(e.center,{lat:g.lat,lng:g.lng,zoom:d})})}else angular.extend(e.center,{lat:c[1],lng:c[0],zoom:d});e.refresh()},e.addMarker=function(a,b,c){if(e.markers.hasOwnProperty(a)){if(1==c)return!1;e.markers[a]=b}else e.markers[a]=b;return!0},e.getMarker=function(a){return e.markers.hasOwnProperty(a)?e.markers[a]:!1},e.removeMarker=function(a){return e.markers.hasOwnProperty(a)?(delete e.markers[a],!0):!1},e.removeAllMarkers=function(){e.markers={}},e.setMarkerMessage=function(a,b){return e.markers.hasOwnProperty(a)?(angular.extend(e.markers[a],{message:b}),!0):!1},e.setMarkerFocus=function(a){return e.markers.hasOwnProperty(a)?(angular.forEach(e.markers,function(a){a.focus=!1}),e.markers[a].focus=!0,!0):!1},e.addPath=function(a,b,c){return e.paths.hasOwnProperty(a)&&1==c?!1:(e.paths[a]=b,e.paths[a])},e.setTiles=function(a){angular.extend(e.tiles,tilesDict[a]),d()},e.setMaxBounds=function(b,c){return a.getMap().then(function(a){a.setMaxBounds([[b[0],b[1]],[c[0],c[1]]])}),d(),!0},e.setMaxBoundsFromPoint=function(b,c){return a.getMap().then(function(a){setTimeout(function(){a.setMaxBounds([[b[0]-c,b[1]-c],[b[0]+c,b[1]+c]])},400)}),d(),!0},e.refresh=function(){d()},e.setBaseLayer=function(a){e.layers.baselayers={},e.layers.baselayers[a]={name:"newBaseMap",url:a,type:"xyz",layerParams:{},layerOptions:{minZoom:1,maxZoom:19}}},e.addOverlay=function(a,b,c){c.maxZoom>19&&(c.maxZoom=19),c.zIndex=10,e.layers.overlays[b]={name:b,type:"xyz",url:"http://107.170.180.141/maps/"+a+"/{z}/{x}/{y}.png",layerOptions:c,visible:!0,opacity:.8}},e.removeOverlays=function(){e.layers.overlays={},map.refresh()},e.addCircleMaskToMarker=function(b,d,f){e.circleMaskLayer=new L.IFCircleMask(e.markers[b],150,f),a.getMap().then(function(a){a.addLayer(e.circleMaskLayer)}),c.$on("leafletDirectiveMarker.dragend",function(){e.circleMaskLayer._draw()})},e.setCircleMaskState=function(a){e.circleMaskLayer&&e.circleMaskLayer._setState(a)},e.removeCircleMask=function(){e.circleMaskLayer&&a.getMap().then(function(a){a.removeLayer(e.circleMaskLayer)})},e.placeImage=function(b,c){return e.placeImageLayer=new L.IFPlaceImage(c,e.markers[b]),a.getMap().then(function(a){a.addLayer(e.placeImageLayer)}),function(a){e.placeImageLayer.setScale(a)}},e.setPlaceImageScale=function(a){e.placeImageLayer.setScale(a)},e.removePlaceImage=function(){e.placeImageLayer&&a.getMap().then(function(a){a.removeLayer(e.placeImageLayer)})},e.getPlaceImageBounds=function(){return e.placeImageLayer?e.placeImageLayer.getBounds():void 0},e}]),angular.module("tidepoolsServices").factory("styleManager",[function(){var a={navBG_color:"rgba(0,188,212,0.8)"};return a.resetNavBG=function(){a.navBG_color="rgba(0,188,212,0.8)"},a}]);var themeDict={urban:{name:"urban",bodyBG_color:"#80DEEA",cardBG_color:"#FFFFFF",titleBG_color:"#00BCD4",navBG_color:"rgba(0, 172, 193, 0.8)",worldTitle_color:"#FFF",landmarkTitle_color:"#304FFE",categoryTitle_color:"#536DFE"},sunset:{name:"sunset",bodyBG_color:"#FFE0B2",cardBG_color:"#FFFFFF",titleBG_color:"#FF9800",navBG_color:"rgba(245, 124, 0, 0.8)",worldTitle_color:"#FFF",landmarkTitle_color:"#FF4081",categoryTitle_color:"#F48FB1"},fairy:{name:"fairy",bodyBG_color:"#7E57C2",cardBG_color:"#FFFFFF",titleBG_color:"#673AB7",navBG_color:"rgba(81, 45, 168, 0.8)",worldTitle_color:"#FFF",landmarkTitle_color:"#FF5722",categoryTitle_color:"#D1C4E9"},arabesque:{name:"arabesque",bodyBG_color:"#C5CAE9",cardBG_color:"#FFFFFF",titleBG_color:"#3F51B5",navBG_color:"rgba(57, 73, 171, 0.8)",worldTitle_color:"#FFF",landmarkTitle_color:"#FF4081",categoryTitle_color:"#F48FB1"}};TweetlistCtrl.$inject=["$location","$scope","db","$rootScope","$routeParams","apertureService"],InstalistCtrl.$inject=["$location","$scope","db","$rootScope","$routeParams","apertureService"],TalktagCtrl.$inject=["$location","$scope","$routeParams","db","$rootScope"],MenuCtrl.$inject=["$location","$scope","db","$routeParams","$rootScope"],ListCtrl.$inject=["$location","$scope","db","$routeParams","$rootScope"],WorldViewCtrl.$inject=["World","$routeParams","$scope","db","$location","$timeout","leafletData","$route","$rootScope"],LandmarkViewCtrl.$inject=["Landmark","$routeParams","$scope","db","$location","$timeout","leafletData","$route","$rootScope","$sce"],AwardsCtrl.$inject=["$location","$scope","db","$timeout","leafletData","$rootScope"],LecturesCtrl.$inject=["$location","$scope","db","$timeout","leafletData","$rootScope"],ShowCtrl.$inject=["$location","$scope","db","$timeout","leafletData","$rootScope"];